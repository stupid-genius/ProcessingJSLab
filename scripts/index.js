(()=>{var X=Object.defineProperty;var St=Object.getOwnPropertyDescriptor;var Pt=Object.getOwnPropertyNames;var Tt=Object.prototype.hasOwnProperty;var At=(t,e)=>()=>(t&&(e=t(t=0)),e);var N=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ht=(t,e)=>{for(var n in e)X(t,n,{get:e[n],enumerable:!0})},$t=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Pt(e))!Tt.call(t,s)&&s!==n&&X(t,s,{get:()=>e[s],enumerable:!(i=St(e,s))||i.enumerable});return t};var F=t=>$t(X({},"__esModule",{value:!0}),t);var C={};Ht(C,{APITransport:()=>at,ConsoleTransport:()=>z,FileTransport:()=>st,default:()=>P,interpolate:()=>ct});function P(t){if(t===void 0)throw new Error("Logger requires the file name of where it's being used.");if(!new.target)return new P(...arguments);Object.defineProperties(this,{log:{value:function(e,n,i){_.indexOf(e)<=_.indexOf(P.state.currentLevel)&&Object.values(P.state.transports).forEach(s=>{queueMicrotask(()=>s.log({level:e,msg:n,category:t,...i}))})}}}),_.forEach(e=>{let n;e==="noop"?n=()=>{}:n=this.log.bind(this,e),Object.defineProperty(this,e,{value:n})})}function z(t){if(!new.target)return new z(...arguments);Object.defineProperty(this,"log",{value:function(e){let n=Object.assign({},t,e);if(n.isTable)console.table(n.msg,n.args);else if(n.group)console[n.group](n.msg);else{let[i,s]=n.style?.length===2?n.style:["font-weight: bold; color: green;","font-style: italic;"];console[n.level](`%c${n.timestamp||new Date().toLocaleTimeString("en-US",n.dateFmt)}%c %c[${n.category}]%c ${n.msg}`,i,"",s,"",...n.args||[])}}})}function st(t){if(window.showSaveFilePicker===void 0){let e="FileTransport requires the File System Access API";throw console.warn(e),new Error(e)}if(!new.target)return new st(...arguments);Object.defineProperty(this,"initialize",{value:async function(){try{let e=await window.showSaveFilePicker({types:[{description:"Log Files",accept:{"text/plain":[".log"]}}]});Object.defineProperty(this,"log",{value:async function(n){let i=Object.assign({},t,n),s;try{s=await e.createWritable({keepExistingData:!0}),await s.write(`${i.timestamp||new Date().toLocaleTimeString("en-US",i.dateFmt)} [${i.category}] ${i.level}: ${i.msg}
`)}catch(r){console.error(r)}finally{await s.close()}}})}catch(e){console.error(e)}}})}function at(t){if(!new.target)return new at(...arguments);Object.defineProperty(this,"log",{value:async function(e){let n=ct(t,e);try{let i=await fetch(n.url,{method:n.method,headers:Object.entries(n.headers||{}).reduce((s,[r,o])=>(s[r]=o,s),{}),body:n.body});console.debug(i)}catch(i){console.error(i)}}})}var _,ct,I=At(()=>{_=["noop","error","warn","info","debug","silly"];Object.defineProperties(P,{addTransport:{value:(t,e)=>{P.state.transports[t]=e}},state:{value:{currentLevel:"noop",transports:{}}},level:{get:()=>P.state.currentLevel},removeTransport:{value:t=>{delete P.state.transports[t]}},setLogLevel:{value:t=>{if(_.some(e=>e===t))P.state.currentLevel=t;else throw new Error(`${t} is not a valid logger level`)}}});P.addTransport("default",z({}));_.reduce((t,e)=>(Object.defineProperty(t,e.toUpperCase(),{enumerable:!0,get:()=>e}),t),P);ct=function t(e,n){if(e instanceof Object){let i=Array.isArray(e)?[]:{};for(let s in e){let r=t(e[s],n);try{i[s]=JSON.parse(r)}catch{r!==void 0&&r!==""&&(i[s]=r)}}return i}return typeof e!="string"?e:e.replace(/\{\{(.+?)}}/g,(i,s)=>{let r=n[s]||"";return r instanceof Object?JSON.stringify(r):r})}});var ut=N((Bt,lt)=>{var Y;typeof window>"u"?Y=(I(),F(C)):Y=(I(),F(C)).default;var Nt=new Y("getopt.js"),ht=function(t){Nt.warn(t)};function d(t,e){typeof d.place>"u"&&(d.place="",d.iplace=0);let n;if(d.optreset>0||d.iplace===d.place.length){if(d.optreset=0,d.place=t[d.optind],d.iplace=0,d.optind>=t.length||d.place.charAt(d.iplace++)!=="-")return d.place="",d.iplace=0,"";if(d.optopt=d.place.charAt(d.iplace++),d.optopt==="-"&&d.iplace===d.place.length)return++d.optind,d.getopt.place="",d.getopt.iplace=0,"";if(d.optopt===0){if(d.place="",d.iplace=0,e.indexOf("-")===-1)return"";d.optopt="-"}}else d.optopt=d.place.charAt(d.iplace++);if(d.optopt===":"||(n=e.indexOf(d.optopt))===-1)return d.iplace===d.place.length&&++d.optind,d.opterr&&e.charAt(0)!==":"&&ht("illegal option -- "+d.optopt),"?";if(e.charAt(n+1)!==":")d.optarg=null,d.iplace===d.place.length&&++d.optind;else{if(d.iplace<d.place.length)d.optarg=d.place.substr(d.iplace);else if(t.length>++d.optind)d.optarg=t[d.optind];else return d.place="",d.iplace=0,e.charAt(0)===":"?":":d.opterr?(ht("option requires an argument -- "+d.optopt),":"):"?";d.place="",d.iplace=0,++d.optind}return d.optopt}d.opterr=1;d.optind=0;d.optopt="";d.optreset=0;d.optarg="";lt.exports=d});var V=N((Ut,dt)=>{var T=ut();function k(t,e,n){if(typeof e=="function")return function(){return e.apply(this,arguments)||k.OK};let i=this;i.echo===void 0&&(i.echo=t.info);let s=[],r=/"([^"]*)"|'([^']*)'|\S+/g,o=async function(a){t.info(`Executing: ${a}`);let l=a.match(r).map(u=>u.replace(/^['"]|['"]$/g,"")),c=l.shift(),p=e[c];if(p===void 0){if(s.includes(c))try{let u=JSON.stringify(await n(a));return t.debug(`RPC Response: ${u}`),i.echo(u),k.OK}catch(u){return i.echo(u),k.ECMDERR}return i.echo(`${c}: no such command`),k.ENOTFOUND}let{func:m,opts:f,usage:x}=p,g=f;if(x&&(g=g?`${g}h`:"h"),g!==void 0){t.debug(`Parsing options: ${g} with ${l}`);let u={},y;for(T.optreset=1,T.optind=0;(y=T(l,g))!=="";)switch(t.debug(`Opt: ${y}, optarg: ${T.optarg}, optind: ${T.optind}`),y){case"h":return i.echo(`Usage: ${x}`),k.OK;case":":return i.echo(`${T.optopt}: option needs a value`),k.EBADARGS;case"?":return i.echo(`${T.optopt}: no such option`),k.EBADARGS;default:t.debug(`Switch: ${y}, optarg: ${T.optarg}`),u[y]=T.optarg||!0}m.opts=u,t.debug(`Switches: ${JSON.stringify(u)}`)}else T.optind=0;return t.debug(`Terms: ${l}`),await m.apply(this,l.slice(T.optind))??k.OK};return n!==void 0&&queueMicrotask(async function(){let a=await n("system.describe");t.debug(`system.describe result: ${a}`),JSON.parse(a).procs.forEach(l=>s.push(l)),e.help.rpcList=s,t.debug(`RPC List: ${s}`),Object.defineProperties(o,{login:{value:async function(l,c){t.info(`Attempting to log in user ${l}`);try{let p=await n(`login ${l} ${c}`);if(p===!1)return i.echo("Login failed"),k.NOTOKEN;let m=n;return o.exit??Object.defineProperty(o,"exit",{value:async function(){t.info("Logging out"),n=m,i.authState=k.NOTOKEN,i.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!0}}))}}),n=new Proxy(n,{apply:function(f,x,g){return f(g[0],p)}}),k.OK}catch(p){return t.error(p),p}}}})}),o}var B=0;Object.defineProperties(k,{OK:{value:B++},ENOTFOUND:{value:B++},ECMDERR:{value:B++},EBADARGS:{value:B++},NOTOKEN:{value:B++}});function Rt(t,e){let n=0;return function(i,s){try{t.info(`Executing RPC: ${i}`);let r=i.trim().split(/\s+/),o=r.shift(),a=r;s&&(a={token:s,params:a}),t.debug(`Method: ${o}, params: ${a}`);try{return e.jsonrpc({id:n++,method:o,params:a}).then(l=>{let c=JSON.parse(l);if(t.debug(`Response: ${JSON.stringify(c)}`),c.error)throw new Error(c.error.message);return c.result})}catch(l){return t.error(l),l}}catch(r){return t.error(r),r}}}dt.exports={JSONRPCClient:Rt,Executor:k}});var ft=N(()=>{var{Executor:R}=V(),Q=(I(),F(C)).default,v=new Q("Terminal.js"),Ct=100,It=1e3,Z=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.parentTerminal=null,this.commandHistory=[],this.historyIndex=-1;let e=localStorage.getItem("commandHistory");e&&(this.commandHistory=JSON.parse(e),v.debug(`Loading command history (${this.commandHistory.length} items)`),this.historyIndex=this.commandHistory.length),this.inputHandler=this.inputHandler.bind(this),this.reset=this.reset.bind(this),this.addEventListener("terminal-reset",this.reset);let n=function(){v.debug("DOMContentLoaded event fired"),this.reset(new CustomEvent("terminal-reset",{detail:{clear:!0}})),document.removeEventListener("DOMContentLoaded",n)}.bind(this);document.addEventListener("DOMContentLoaded",n)}connectedCallback(){v.debug("Terminal connected")}disconnectedCallback(){v.debug("Terminal disconnected"),this.inputLine.removeEventListener("keydown",this.inputHandler),this.removeEventListener("click",this.focusHandler)}reset(e){if(v.debug(`Terminal reset (${this.parentTerminal?"sub-terminal":"main terminal"})`),v.debug(`Auth state: ${this.authState}, RPC enabled: ${this.rpcEnabled}`),this.rpcEnabled&&this.authState!==R.OK)v.debug("logging in"),this.loginModal();else{let n=e.detail?.clear??!1;v.debug(`reset ${n?"and clear ":""}terminal`),this.uiModal(n)}this.focusHandler=function(){this.inputLine.focus()}.bind(this),this.addEventListener("click",this.focusHandler),this.focusHandler()}applyStyles(){let e=this.querySelector("style").cloneNode(!0);this.shadowRoot.appendChild(e)}loginModal(){this.shadowRoot.innerHTML="",this.applyStyles();let e=this.querySelector("template#login").content.cloneNode(!0);this.shadowRoot.appendChild(e),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.output=this.shadowRoot.querySelector(".output"),this.echo("Please log in");let n,i,s=async r=>{if(r.key==="Enter"){r.preventDefault();let o=(this.inputLine.value??this.inputLine.textContent).trim();if(n===void 0?n=o:i=o,n&&i)try{if(this.authState=await this.executor.login(n,i),v.debug(`Login state: ${this.authState}`),this.authState===R.NOTOKEN){this.loginModal(),this.focusHandler();return}this.inputLine.removeEventListener("keydown",s),this.removeEventListener("click",this.focusHandler),this.reset(new CustomEvent("terminal-reset",{detail:{clear:!0}}))}catch(a){this.echo(a),v.error(a)}else{v.debug(`awaiting password for ${n}`);let a=document.createElement("input");a.type="password",a.classList.add("input-line"),this.inputLine.textContent=this.inputLine.value="",this.inputLine.removeEventListener("keydown",s),this.removeEventListener("click",this.focusHandler),this.inputLine.replaceWith(a),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.prompt="password:",this.inputLine.addEventListener("keydown",s),this.addEventListener("click",this.focusHandler),this.focusHandler()}}};this.inputLine.addEventListener("keydown",s)}uiModal(e){let n=this.shadowRoot.querySelector(".output")?.innerHTML;this.shadowRoot.innerHTML="",this.applyStyles();let i=this.querySelector("template#ui").content.cloneNode(!0);this.shadowRoot.appendChild(i),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.output=this.shadowRoot.querySelector(".output"),e&&this.greeting?(v.debug("clearing terminal"),this.echo(this.greeting)):this.output.innerHTML=n??"",this.inputLine.addEventListener("keydown",this.inputHandler),this.inputLine.focus()}get executor(){return this._executor}set executor(e){v.info("Setting executor"),this._executor=e}get greeting(){return this.getAttribute("greeting")}set greeting(e){e===void 0?this.removeAttribute("greeting"):this.setAttribute("greeting",e)}get prompt(){return this.shadowRoot.querySelector(".prompt").textContent}set prompt(e){let n=this.shadowRoot.querySelector(".prompt");n.innerHTML=`${e}&nbsp;`}get rpcEnabled(){return this.getAttribute("rpc")==="true"}inputHandler(e){switch(e.key){case"Enter":{e.preventDefault();let n=this.inputLine.textContent.trim();this.inputLine.textContent="",this.echo(`${this.prompt}${n}`),this.processCommand(n),this.historyIndex=this.commandHistory.length;break}case"ArrowUp":v.debug(`History index (back): ${this.historyIndex}`),this.historyIndex>0&&(this.historyIndex-=1,this.inputLine.textContent=this.commandHistory[this.historyIndex]);break;case"ArrowDown":v.debug(`History index (forward): ${this.historyIndex}`),this.historyIndex<this.commandHistory.length-1?(this.historyIndex+=1,this.inputLine.textContent=this.commandHistory[this.historyIndex]):(this.historyIndex=this.commandHistory.length,this.inputLine.textContent="");break}}async processCommand(e){try{let n=await this.executor(e);switch(v.debug(`Status: ${n}`),n){case R.OK:v.debug(`${e} executed successfully`),e!==this.commandHistory[this.commandHistory.length-1]&&(this.commandHistory.push(e),this.commandHistory.length>Ct&&this.commandHistory.shift(),localStorage.setItem("commandHistory",JSON.stringify(this.commandHistory)));break;case R.ENOTFOUND:v.info(`${e} not found`);break;case R.ECMDERR:v.error(`Error executing ${e}`);break;case R.EBADARGS:v.warn(`${e} called with bad arguments`);break;default:v.error(`Unknown status: ${n} for ${e}`);break}}catch(n){v.error(n),this.echo(n)}}clear(){this.output.innerHTML=""}echo(e){for(e!=null&&e!==""&&(this.output.innerHTML+=`<div>${e}</div>`);this.output.children.length>It;)this.output.removeChild(this.output.firstChild);this.inputLine.getBoundingClientRect().bottom>window.innerHeight&&this.inputLine.scrollIntoView({behavior:"smooth"})}log(e){Q.level==="debug"&&(typeof e=="string"?console.info(e):console.dir(e))}startSubTerminal(e){v.info(`Starting sub-terminal: ${e.name}`),this.removeEventListener("terminal-reset",this.reset);let n=new Q(`Executor.js (${e.name})`),i=document.createElement("ng-terminal");return i.innerHTML=this.innerHTML,i.greeting=e.greeting,i.executor=R.bind(i)(n,e.registry),i.parentTerminal=this,this.replaceWith(i),i.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!0}})),e.prompt!==void 0&&(i.prompt=e.prompt),i}exitSubTerminal(){this.parentTerminal?(v.info("Exiting sub-terminal"),v.debug(`Parent terminal: ${JSON.stringify(this.parentTerminal)}`),this.parentTerminal.addEventListener("terminal-reset",this.parentTerminal.reset),this.replaceWith(this.parentTerminal),this.parentTerminal.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!1}}))):v.warn("No parent terminal found")}};customElements.define("ng-terminal",Z)});var J=N((Gt,pt)=>{var qt=(I(),F(C)).default,q=new qt("Renderer.js");function W(t,e){if(!new.target)return new W(...arguments);let n=t.pixels.toArray(),i=n.length,s=new Proxy(t,{get:function(r,o,a){if(typeof o=="string"&&!isNaN(o)){let l=+o;if(Number.isInteger(l)&&l>=0&&l<i)return n[l]}else return Reflect.get(r,o,a)},set:function(r,o,a,l){if(typeof o=="string"&&!isNaN(o)){let c=+o;Number.isInteger(c)&&c>=0&&c<i&&(n[c]=Array.isArray(a)?e.color.apply(this,a):a)}else return Reflect.set(r,o,a,l)}});return t.loaded=!0,Object.defineProperties(s,{blit:{value:function(r,o){t.pixels.set(n),e.image(t,r,o)}},length:{value:n.length},update:{value:function(){t.pixels.set(n)}}}),s}function tt(t){if(!new.target)return new tt(...arguments);let e=0,n=[];Object.defineProperties(n,{flip:{value:function(){e^=1}},read:{get:function(){return this[e^1]}},write:{get:function(){return this[e]}}});let i=t.createImage();n.push({buffer:i,get pixels(){return i.pixels.toArray()}});let s=t.createImage();n.push({buffer:s,get pixels(){return s.pixels.toArray()}}),Object.defineProperties(this,{flip:{value:function(){let o=n.write.buffer;o.update(),t.background(o),n.flip()}},readBuffer:{get:function(){return n.read.pixels}},writeBuffer:{get:function(){return n.write.buffer}}})}function U(t){if(U.instance!==void 0)return U.instance;if(!new.target)return new U(...arguments);let e={background:4278849802,frameRate:60,height:t.height,width:t.width},n;Object.defineProperties(this,{createImage:{value:function(s,r){let o=n.createImage(s??t.width,r??t.height);return new W(o,n)}},frame:{set:function(s){q.debug("pjs.draw set"),Object.defineProperty(n,"draw",{value:s,writable:!0})}},doubleBuffer:{value:function(){return new tt(this)}},init:{value:function(s){n!==void 0&&n.exit();let r=Object.assign({},e,s);n=new Processing(t,o=>{q.info("Processing.js created"),q.debug(`canvas width (${t.width}) height (${t.height})`),Object.defineProperties(o,{keyPressed:{value:function(){switch(o.keyCode){case o.UP:o.loop();break;case o.DOWN:o.noLoop();break;case o.LEFT:o.save("image.png");break;case o.RIGHT:o.redraw()}},writable:!0},setup:{value:function(){o.size(r.width,r.height),q.debug(`processingjs width (${o.width}) height (${o.height}) ${o.use3DContext}`),o.frameRate(r.frameRate),o.noLoop(),o.background(r.background),q.info("Processing.js setup")}}})})}},input:{set:function(s){q.debug("keyPressed set"),Object.defineProperty(n,"keyPressed",{value:s,writable:!0})}},pixelHeight:{get:function(){return 0}},pixelWidth:{get:function(){return 0}},showRuler:{set:function(){}}}),this.init();let i=new Proxy(this,{get:function(s,r){return s[r]??n[r]}});return Object.defineProperty(U,"instance",{value:i}),i}pt.exports={DoubleBuffer:tt,Image:W,Renderer:U}});var yt=N((Xt,gt)=>{function j(){if(j.instance instanceof j)return j.instance;if(!new.target)return new j(...arguments);Object.defineProperty(j,"instance",{value:this});let t=Math.PI/180;Object.defineProperties(this,{cos:{value:{},enumerable:!0},sin:{value:{},enumerable:!0}});for(let e=0;e<=360;++e)Object.defineProperty(this.cos,e,{value:Math.cos(e*t)}),Object.defineProperty(this.sin,e,{value:Math.sin(e*t)})}var et=Object.freeze({addColors:(...t)=>t.length===0?[]:t[0].map((e,n)=>t.reduce((i,s)=>i+s[n],0)),decodeColor:t=>[t>>16&255,t>>8&255,t&255,t>>>24],distance:(t,e,n,i)=>Math.hypot(Math.abs(n-t),Math.abs(i-e)),fastInvSqrt:()=>1,fastTrig:j(),randomColor:(t=!1)=>{let e=Array.from({length:3},()=>et.roll(255));return e.push(t?et.roll(255):255),e},range:(t,e)=>{let n=Math.random()*(e-t);return Number.isInteger(t)&&Number.isInteger(e)&&(n=Math.floor(n)),n+t},roll:t=>Math.floor(Math.random()*t)});gt.exports=et});var bt=N((zt,xt)=>{function mt(t,e){if(!new.target)return new mt(...arguments);let n=2,i=new s;i.next=new s,i.prev=i.next,i.prev.next=i,i.prev.prev=i,i.active=!1,i.prev.active=!1,this.acceleration=[0,.25],this.elasticity=.2,this.MAX_COUNT=3e3,Object.defineProperties(this,{count:{get:function(){return n}},createParticle:{value:function(r,o,a,l,c,p,m,f,x){if(i.prev.active){if(n>=this.MAX_COUNT)return;let g=new s(r,o,a,l,c,p,m,f,x);g.next=i,g.prev=i.prev,g.prev.next=g,i.prev=g,i=g,++n}else{let g=i.prev;g.activate(r,o,a,l,c,p,m,f,x),i=g}}},list:{get:function(){return i}},render:{value:function(){let r=i;for(;r.active;){e.call(r,this),t.stroke(r.r,r.g,r.b,r.a),t.point(r.x,r.y);let o=r;if(r.ttl>0&&++r.t>=r.ttl&&(r.active=!1),r=r.next,r===i)break;o.active||(o===i?i=o.next:(o.next.prev=o.prev,o.prev.next=o.next,o.next=i,o.prev=i.prev,i.prev.next=o,i.prev=o))}}}});function s(r,o,a,l,c,p,m,f,x){if(!new.target)return new s(...arguments);Object.defineProperties(this,{activate:{value:function(g,u,y,b,M,O,S,A,$){this.active=!0,this.ttl=g,this.t=0,this.x=u,this.y=y,this.dx=b,this.dy=M,this.ddx=0,this.ddy=0,this.dddx=0,this.dddy=0,this.r=O,this.g=S,this.b=A,this.a=$}}}),this.activate(r,o,a,l,c,p,m,f,x)}}xt.exports=mt});var Mt=N((Yt,vt)=>{var w=yt(),H=bt(),h=J().Renderer();function wt(t,e,n,i){let s=i%t,r=Math.floor(i/t),o=n,a=Math.floor(s/e)%2==0,l=Math.floor(r/e)%2==0;return a!=l&&(o=0),[o,o,o,255]}var jt={boids:function(){let t=h.width,e=h.height,n=t/2,i=e/2,s=200,r=3,o=5e-4,a=100,l=40,c=1,p=1.25,m=1,f=.75,x=new H(h,function(u){let y={x:0,y:0},b={x:0,y:0},M={x:0,y:0},O={x:0,y:0},S=0,A=0,$=u.list,E=$;for(;E.active;){if(E===this){if(E=E.next,E===$)break;continue}let L=Math.hypot(this.x-E.x,this.y-E.y);if(L<a&&(y.x+=E.dx,y.y+=E.dy,b.x+=E.x,b.y+=E.y,S++),L<l){let D=(l-L)/l;M.x+=(this.x-E.x)*D,M.y+=(this.y-E.y)*D,A++}if(E=E.next,E===$)break}if(S>0){y.x/=S,y.y/=S;let L=Math.hypot(y.x,y.y);L>0&&(y.x=y.x/L*o*c,y.y=y.y/L*o*c),b.x=(b.x/S-this.x)*o*p,b.y=(b.y/S-this.y)*o*p}if(A>0){M.x/=A,M.y/=A;let L=Math.hypot(M.x,M.y);L>0&&(M.x=M.x/L*o*m,M.y=M.y/L*o*m)}if(Math.random()>f){let L=Math.atan2(this.dy,this.dx)+w.range(-.1,.1),D=Math.hypot(this.dx,this.dy);O.x=D*Math.cos(L)-this.dx,O.y=D*Math.sin(L)-this.dy}this.ddx=y.x+b.x+M.x+O.x,this.ddy=y.y+b.y+M.y+O.y,this.dx+=this.ddx,this.dy+=this.ddy;let G=Math.hypot(this.dx,this.dy);G>r&&(this.dx=this.dx/G*r,this.dy=this.dy/G*r);let Lt=this.x-3*this.dx,kt=this.y-3*this.dy;this.x+=this.dx,this.y+=this.dy,h.line(this.x,this.y,Lt,kt),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-1?(this.y=e-1,this.dy*=-1):this.y<0&&(this.y=0,this.dy*=-1)}),g=w.range(0,2*Math.PI);for(let u=0;u<s;++u){let y=w.range(.001,1)*r,b=w.range(-.1,.1);x.createParticle(0,w.range(n-10.01,n+10),w.range(i-10.01,i+10),y*Math.cos(b+g),y*Math.sin(b+g),...w.randomColor())}h.stroke(0,0,0,255),h.frame=function(){h.background(0),x.render()},h.loop()},bz:function(){let t=h.width,e=Array.from({length:8},()=>Math.random()*t),n=Array.from({length:8},()=>Math.random()*t),i=Array.from({length:8},()=>Math.random()*15);h.background(255),h.noFill(),h.frame=function(){h.stroke(0,0,0,20),e.map(function(s,r,o){let a=s+i[r];a<0?(a=0,i[r]*=-1):a>t&&(a=t,i[r]*=-1),o[r]=a}),h.bezier.apply(null,e),h.stroke(255,128,128,20),n.map(function(s,r,o){let a=s+i[r];a<0?(a=0,i[r]*=-1):a>t&&(a=t,i[r]*=-1),o[r]=a}),h.bezier.apply(null,n)},h.loop()},cell:function(t=30,e=!1,n=200,i=200){h.init({background:0,height:+i,width:+n});let s=h.width,r=h.height,o=1,a=0,l=new Array(s*r).fill(a),c=(f=>{let x=f.toString(2).padStart(8,"0"),g=[];for(let u=0;u<8;++u)+x[7-u]&&g.push(u);return(u,y)=>{let b=y-1,M=parseInt([l[b*s+(u-1)],l[b*s+u],l[b*s+(u+1)]].join(""),2);return g.some(O=>M===O)?o:a}})(+t);if(e&&e!=="false")for(let f=0;f<s;++f)l[f]=Math.random()>.5?o:a,h.point(f,0);else l[s/2]=o,h.point(s/2,0);let p=0,m=l.length/s;h.stroke(255),h.frame=function(){for(let f=0;f<s;++f){let x=c(f,p);x&&(l[p*s+f]=x,h.point(f,p))}p!==m&&p++},h.loop()},chaos:function(t="3"){h.init({frameRate:400});let e=h.width,n=h.height,i=e/2,s=n/2,r=i-50,o=Math.PI/180,a={3:[{x:e/2,y:50},{x:50,y:n-50},{x:e-50,y:n-50}],5:[{x:e-50,y:50},{x:50,y:50},{x:50,y:n-50},{x:e-50,y:n-50},{x:i,y:s}],6:[{x:Math.cos(0)*r+i,y:Math.sin(0)*r+s},{x:Math.cos(60*o)*r+i,y:Math.sin(60*o)*r+s},{x:Math.cos(120*o)*r+i,y:Math.sin(120*o)*r+s},{x:Math.cos(180*o)*r+i,y:Math.sin(180*o)*r+s},{x:Math.cos(240*o)*r+i,y:Math.sin(240*o)*r+s},{x:Math.cos(300*o)*r+i,y:Math.sin(300*o)*r+s}]}[t],l={3:2,5:1.5,6:1.5}[t];h.background(0),h.stroke(255,255,255,255);for(let{x:m,y:f}of a)h.point(m,f);let c=Math.random()*e,p=Math.random()*n;h.frame=function(){let m=w.roll(a.length);c+=(a[m].x-c)/l,p+=(a[m].y-p)/l,h.point(c,p)},h.loop()},fire:function(){h.init({background:0,frameRate:60,height:300,width:300});let t=h.width,e=h.doubleBuffer(),n=e.writeBuffer;for(let r=0;r<n.length;++r)n[r]=[0,0,0,255];e.flip(),n=e.writeBuffer;for(let r=0;r<n.length;++r)n[r]=[0,0,0,255];e.flip();let i=e.readBuffer.length/t,s=h.color(255,128,96);h.frame=function(){let r=e.readBuffer,o=e.writeBuffer;for(let a=t;a<o.length-t;++a){if(a%t<1||a%t>=t-1)continue;let l=a/t;if(Math.random()<Math.pow(Math.E,Math.pow(l/i,4))-1&&Math.random()>.975){o[a]=s;continue}o[a]=w.addColors(w.decodeColor(r[a-1]),w.decodeColor(r[a]),w.decodeColor(r[a+1]),w.decodeColor(r[a+t])).map((c,p)=>{if(p===3)return 255;let m=c/4.25;return m<10?0:m})}e.flip()},h.loop()},fireworks:function(){let t=h.width,e=h.height,n=new H(h,function(){this.dx+=n.acceleration[0],this.dy+=n.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.g=255*c*c,this.b=255*c*c*c*c,this.a=255*c}),i=new H(h,function(){this.dx+=i.acceleration[0],this.dy+=i.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.b=255*Math.pow(c,.2),this.g=255*c*c,this.r=255*c*c*c*c,this.a=255*c}),s=new H(h,function(){this.dx+=s.acceleration[0],this.dy+=s.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.g=255*Math.pow(c,.2),this.r=255*c*c,this.b=255*c*c*c*c,this.a=255*c}),r=new H(h,function(){this.dx+=r.acceleration[0],this.dy+=r.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.g=255*Math.pow(c,.2),this.b=255*c*c*c*c,this.a=255*c}),o=new H(h,function(){this.dx+=o.acceleration[0],this.dy+=o.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.b=255*c*c*c*c,this.g=255*c,this.a=255*c}),a=new H(h,function(){this.dx+=a.acceleration[0],this.dy+=a.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.b=255*Math.pow(c,.2),this.g=255*c*c*c*c,this.a=255*c});n.acceleration=[0,.15],i.acceleration=[0,.15],s.acceleration=[0,.15],r.acceleration=[0,.15],o.acceleration=[0,.15],a.acceleration=[0,.15];function l(c,p){let m;switch(w.range(0,5)){case 0:m=n;break;case 1:m=i;break;case 2:m=s;break;case 3:m=r;break;case 4:m=a;break;case 5:m=o;break}for(let f=0;f<300;++f){let x=w.range(0,Math.PI*2),g=w.range(.001,10);m.createParticle(w.range(50.001,100),c,p,Math.cos(x)*g,Math.sin(x)*g,0,0,0,0)}}h.frame=function(){h.background(0),Math.random()>.95&&l(w.range(.001,t),w.range(.001,e/2)),n.render(),i.render(),s.render(),r.render(),a.render(),o.render()},h.loop()},fountain:function(){let t=h.width,e=h.height,n=new H(h,function(){this.dx+=n.acceleration[0],this.dy+=n.acceleration[1],this.x+=this.dx,this.y+=this.dy;let r=1-this.t/this.ttl;this.r=255*Math.pow(r,.2),this.g=255*r*r,this.b=255*r*r*r*r,this.a=255*Math.pow(r,.2),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-2?(this.dy<.25?this.y=e-1:this.y=e-2,this.dy*=-1.2*Math.random()*n.elasticity,Math.random()<.5?this.dx-=this.dy:this.dx+=this.dy):this.y<0&&(this.y=0,this.dy*=-1*n.elasticity),this.y===e-1&&(this.active=!1)}),i=-20.01,s=[255,255,255,255];h.frame=function(){h.background(0);for(let r=0;r<15;++r){let o=w.range(-.098,.098),a=w.range(i,.8*i);n.createParticle(w.range(10,30.01)*-a,t/2,e-20,Math.sin(o)*a,Math.cos(o)*a,...s)}n.render()},h.loop()},lens:function(t=150,e=30){t=+t,e=+e;let n=h.width,i=h.createImage(),s=i.height;for(let u=0;u<i.length;++u)i[u]=wt(s,s/32,255,u);i.update();let r=h.createImage(t,t),o=new Array(t*t).fill(0),a=Math.round(t/2),l=a*a,c=a*(t+1),p;for(let u=0;u<l;++u){let y=u%a,b=Math.floor(u/a),M=y*y,O=b*b,S=0,A=0;if(M+O<l){let $=e/Math.sqrt(e*e-(M+O-l));S=Math.floor(y*$)-y,A=Math.floor(b*$)-b}p=A*n+S,o[c-b*t-y]=-p,o[c+b*t+y]=p,p=-A*n+S,o[c-b*t+y]=p,o[c+b*t-y]=-p}let m=n/2,f=n/2,x=1,g=2;h.frame=function(){m+=x,f+=g,m<0&&(m=0,x=-x),m>n-t&&(m=n-t,x=-x),f<0&&(f=0,g=-g),f>n-t&&(f=n-t,g=-g),h.background(i);let u=f*n+m;for(let y=0;y<t*t;++y)r[y]=i[Math.round(u)+Math.floor(y/t)*n+y%t+o[y]];r.blit(m,f)},h.loop()},life:function(t=300,e=300){h.init({background:0,frameRate:12,height:+e,width:+t});let n=h.width,i=h.height,s=.05,r=0,o=1,a=1,l=0,c=-1,p=Array.from(Array(n*i)).map(()=>Array.from(Array(2)));p.forEach(f=>{f[r]=l,f[o]=Math.random()<s?a:l});function m(f){let x=f%n,g=Math.floor(f/n),u=0;return g>0&&(x>0&&(u+=p[f-n-1][r]),x<n-1&&(u+=p[f-n+1][r]),u+=p[f-n][r]),g<i-1&&(x>0&&(u+=p[f+n-1][r]),x<n-1&&(u+=p[f+n+1][r]),u+=p[f+n][r]),x>0&&(u+=p[f-1][r]),x<n-1&&(u+=p[f+1][r]),u}h.stroke(255),h.frame=function(){h.background(0),p.forEach((f,x)=>{let g=p[x];if(f[o]===a||f[r]===a){g[r]=a;let M=x%n,O=x/n;h.point(M,O)}f[o]===c&&(g[r]=l),g[o]=l;let u=x-3*n;if(u<0)return;let y=p[u],b=m(u);b===3&&y[r]===l&&(y[o]=a),(b<2||b>3)&&y[r]===a&&(y[o]=c)})},h.loop()},pattern:function(){let t=h.createImage(),e=t.height;for(let n=0;n<t.length;++n)t[n]=wt(e,e/8,255,n);t.update(),h.background(t)},plasma:function(){h.init({background:0,height:300,width:300});let t=h.width,e=h.height,n=h.createImage(),i={},s={};function r(g){let u=1-g/255,y=255*u,b=255*u*u;return[255*u*u*u*u,b,y,255]}for(let g=0;g<256;++g)s[g]=r(g);for(let g=0;g<512;++g){let u=g*.703125*.0174532;i[g]=Math.sin(u)*1024}let o=0,a=0,l=0,c=0,p=0,m=0,f=0,x=0;h.frame=function(){f=l,x=c;for(let g=0;g<e;++g){p=o+5,m=a+3,f&=511,x&=511;for(let u=0;u<t;++u){p&=511,m&=511;let b=128+(i[p]+i[m]+i[f]+i[x]>>4);n[g*t+u]=s[b],p+=5,m+=3}f+=1,x+=3}o+=9,l+=8,n.update(),h.background(n)},h.loop()},snow:function(){let t=h.width,e=h.height,n=new H(h,function(){this.x+=this.dx,this.y+=this.dy,(this.x>=t-1||this.y>=e-1||this.y<0)&&(this.active=!1)});h.frame=function(){h.background(0),n.createParticle(0,w.range(-t/2,t-1),0,w.range(0,.25),w.range(.4,.6),255,255,255,w.range(96,255)),n.render()},h.loop()},stars:function(){let t=h.width,e=h.height,n=t/2,i=e/2,s=n*.75,r=new H(h,function(){let o=this.x-3*this.dx,a=this.y-3*this.dy;this.x+=this.dx,this.y+=this.dy,h.line(this.x,this.y,o,a),(this.x>=t-1||this.y>=e-1||this.x<0||this.y<0)&&(this.active=!1);let l=Math.hypot(this.dx,this.dy),c=Math.min(w.distance(this.x,this.y,n,i),n);this.a=128*Math.max(1-c/s,0)+64*(l/10)+64*Math.max(1-this.t++,0)});h.frame=function(){h.background(0);for(let o=0;o<20;++o){let a=(w.roll(t)+w.roll(t))/2,l=w.roll(e)+w.roll(e)/2,c=Math.min(w.distance(a,l,n,i),n),p=-Math.atan2(i-l,a-n),m=10*(c/n)+1;r.createParticle(0,a,l,Math.cos(p)*m,Math.sin(p)*m,255,255,255,0)}r.render()},h.loop()}};vt.exports=jt});var Ot=N((Vt,Et)=>{var K=Mt(),nt=J().Renderer(),it=Object.freeze({cat:{func:function(t){this.echo(K[t].toString())},man:"Print code listing for [demo]"},clear:{func:function(){this.clear()}},help:{func:function(t){t===void 0?(this.echo("Available commands:"),Object.keys(it).forEach(e=>this.echo(e))):this.echo(it[t].man)},man:"Print help text for [command].  If no command is passed, list available commands.",usage:"help [command]"},load:{func:function(t,...e){this.echo(`Loading ${t}\u2026`),t in K&&(nt.init(),K[t].apply(this,e))},man:"Load a demo.  Some demos accept additional arguments.\n<b>Example:</b>\n`load chaos 6`.",usage:"load [demo] [args]"},ls:{func:function(){this.echo("Available demos:"),Object.keys(K).forEach(t=>this.echo(t))},man:"List available demos"},properties:{func:function(t){t===void 0&&this.echo(JSON.stringify(nt,null,2)),this.echo(nt[t])}}});Et.exports=it});var ot=(I(),F(C)).default,{Executor:Dt}=V();ft();var{Renderer:Ft}=J();ot.setLogLevel("debug");var rt=new ot("index.js");window.addEventListener("load",()=>{rt.info("Creating renderer");let t=document.querySelector("canvas"),e=t.getBoundingClientRect();t.width=e.width,t.height=e.height,rt.debug(`initial canvas width (${t.width}) height (${t.height})`),Ft(t),rt.info("Creating executor");let n=document.querySelector("ng-terminal"),i=new ot("Executor.js");n.executor=Dt.bind(n)(i,Ot())});})();
