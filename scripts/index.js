(()=>{var U=Object.defineProperty;var xt=Object.getOwnPropertyDescriptor;var vt=Object.getOwnPropertyNames;var Mt=Object.prototype.hasOwnProperty;var Lt=(t,e)=>()=>(t&&(e=t(t=0)),e);var P=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Et=(t,e)=>{for(var n in e)U(t,n,{get:e[n],enumerable:!0})},Ot=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of vt(e))!Mt.call(t,s)&&s!==n&&U(t,s,{get:()=>e[s],enumerable:!(i=xt(e,s))||i.enumerable});return t};var R=t=>Ot(U({},"__esModule",{value:!0}),t);var H={};Et(H,{APITransport:()=>tt,ConsoleTransport:()=>_,FileTransport:()=>W,default:()=>E,interpolate:()=>et});function E(t){if(t===void 0)throw new Error("Logger requires the file name of where it's being used.");if(!new.target)return new E(...arguments);Object.defineProperties(this,{log:{value:function(e,n,i){I.indexOf(e)<=I.indexOf(E.state.currentLevel)&&Object.values(E.state.transports).forEach(s=>{queueMicrotask(()=>s.log({level:e,msg:n,category:t,...i}))})}}}),I.forEach(e=>{let n;e==="noop"?n=()=>{}:n=this.log.bind(this,e),Object.defineProperty(this,e,{value:n})})}function _(t){if(!new.target)return new _(...arguments);Object.defineProperty(this,"log",{value:function(e){let n=Object.assign({},t,e);if(n.isTable)console.table(n.msg,n.args);else if(n.group)console[n.group](n.msg);else{let[i,s]=n.style?.length===2?n.style:["font-weight: bold; color: green;","font-style: italic;"];console[n.level](`%c${n.timestamp||new Date().toLocaleTimeString("en-US",n.dateFmt)}%c %c[${n.category}]%c ${n.msg}`,i,"",s,"",...n.args||[])}}})}function W(t){if(window.showSaveFilePicker===void 0){let e="FileTransport requires the File System Access API";throw console.warn(e),new Error(e)}if(!new.target)return new W(...arguments);Object.defineProperty(this,"initialize",{value:async function(){try{let e=await window.showSaveFilePicker({types:[{description:"Log Files",accept:{"text/plain":[".log"]}}]});Object.defineProperty(this,"log",{value:async function(n){let i=Object.assign({},t,n),s;try{s=await e.createWritable({keepExistingData:!0}),await s.write(`${i.timestamp||new Date().toLocaleTimeString("en-US",i.dateFmt)} [${i.category}] ${i.level}: ${i.msg}
`)}catch(r){console.error(r)}finally{await s.close()}}})}catch(e){console.error(e)}}})}function tt(t){if(!new.target)return new tt(...arguments);Object.defineProperty(this,"log",{value:async function(e){let n=et(t,e);try{let i=await fetch(n.url,{method:n.method,headers:Object.entries(n.headers||{}).reduce((s,[r,o])=>(s[r]=o,s),{}),body:n.body});console.debug(i)}catch(i){console.error(i)}}})}var I,et,T=Lt(()=>{I=["noop","error","warn","info","debug","silly"];Object.defineProperties(E,{addTransport:{value:(t,e)=>{E.state.transports[t]=e}},state:{value:{currentLevel:"noop",transports:{}}},level:{get:()=>E.state.currentLevel},removeTransport:{value:t=>{delete E.state.transports[t]}},setLogLevel:{value:t=>{if(I.some(e=>e===t))E.state.currentLevel=t;else throw new Error(`${t} is not a valid logger level`)}}});E.addTransport("default",_({}));I.reduce((t,e)=>(Object.defineProperty(t,e.toUpperCase(),{enumerable:!0,get:()=>e}),t),E);et=function t(e,n){if(e instanceof Object){let i=Array.isArray(e)?[]:{};for(let s in e){let r=t(e[s],n);try{i[s]=JSON.parse(r)}catch{r!==void 0&&r!==""&&(i[s]=r)}}return i}return typeof e!="string"?e:e.replace(/\{\{(.+?)}}/g,(i,s)=>{let r=n[s]||"";return r instanceof Object?JSON.stringify(r):r})}});var rt=P((qt,it)=>{var K;typeof window>"u"?K=(T(),R(H)):K=(T(),R(H)).default;var $t=new K("getopt.js"),nt=function(t){$t.warn(t)};function l(t,e){typeof l.place>"u"&&(l.place="",l.iplace=0);let n;if(l.optreset>0||l.iplace===l.place.length){if(l.optreset=0,l.place=t[l.optind],l.iplace=0,l.optind>=t.length||l.place.charAt(l.iplace++)!=="-")return l.place="",l.iplace=0,"";if(l.optopt=l.place.charAt(l.iplace++),l.optopt==="-"&&l.iplace===l.place.length)return++l.optind,l.getopt.place="",l.getopt.iplace=0,"";if(l.optopt===0){if(l.place="",l.iplace=0,e.indexOf("-")===-1)return"";l.optopt="-"}}else l.optopt=l.place.charAt(l.iplace++);if(l.optopt===":"||(n=e.indexOf(l.optopt))===-1)return l.iplace===l.place.length&&++l.optind,l.opterr&&e.charAt(0)!==":"&&nt("illegal option -- "+l.optopt),"?";if(e.charAt(n+1)!==":")l.optarg=null,l.iplace===l.place.length&&++l.optind;else{if(l.iplace<l.place.length)l.optarg=l.place.substr(l.iplace);else if(t.length>++l.optind)l.optarg=t[l.optind];else return l.place="",l.iplace=0,e.charAt(0)===":"?":":l.opterr?(nt("option requires an argument -- "+l.optopt),":"):"?";l.place="",l.iplace=0,++l.optind}return l.optopt}l.opterr=1;l.optind=0;l.optopt="";l.optreset=0;l.optarg="";it.exports=l});var J=P((jt,st)=>{var O=rt();function L(t,e,n){if(typeof e=="function")return function(){return e.apply(this,arguments)||L.OK};let i=this;i.echo===void 0&&(i.echo=t.info);let s=[],r=/"([^"]*)"|'([^']*)'|\S+/g,o=async function(a){t.info(`Executing: ${a}`);let u=a.match(r).map(b=>b.replace(/^['"]|['"]$/g,"")),c=u.shift(),d=e[c];if(d===void 0){if(s.includes(c))try{let b=JSON.stringify(await n(a));return t.debug(`RPC Response: ${b}`),i.echo(b),L.OK}catch(b){return i.echo(b),L.ECMDERR}return i.echo(`${c}: no such command`),L.ENOTFOUND}let{func:f,opts:y,usage:p}=d,g=y;if(p&&(g=g?`${g}h`:"h"),g!==void 0){t.debug(`Parsing options: ${g} with ${u}`);let b={},x;for(O.optreset=1,O.optind=0;(x=O(u,g))!=="";)switch(t.debug(`Opt: ${x}, optarg: ${O.optarg}, optind: ${O.optind}`),x){case"h":return i.echo(`Usage: ${p}`),L.OK;case":":return i.echo(`${O.optopt}: option needs a value`),L.EBADARGS;case"?":return i.echo(`${O.optopt}: no such option`),L.EBADARGS;default:t.debug(`Switch: ${x}, optarg: ${O.optarg}`),b[x]=O.optarg||!0}f.opts=b,t.debug(`Switches: ${JSON.stringify(b)}`)}else O.optind=0;return t.debug(`Terms: ${u}`),await f.apply(this,u.slice(O.optind))??L.OK};return n!==void 0&&queueMicrotask(async function(){let a=await n("system.describe");t.debug(`system.describe result: ${a}`),JSON.parse(a).procs.forEach(u=>s.push(u)),e.help.rpcList=s,t.debug(`RPC List: ${s}`),Object.defineProperties(o,{login:{value:async function(u,c){t.info(`Attempting to log in user ${u}`);try{let d=await n(`login ${u} ${c}`);if(d===!1)return i.echo("Login failed"),L.NOTOKEN;let f=n;return o.exit??Object.defineProperty(o,"exit",{value:async function(){t.info("Logging out"),n=f,i.authState=L.NOTOKEN,i.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!0}}))}}),n=new Proxy(n,{apply:function(y,p,g){return y(g[0],d)}}),L.OK}catch(d){return t.error(d),d}}}})}),o}var q=0;Object.defineProperties(L,{OK:{value:q++},ENOTFOUND:{value:q++},ECMDERR:{value:q++},EBADARGS:{value:q++},NOTOKEN:{value:q++}});function kt(t,e){let n=0;return function(i,s){try{t.info(`Executing RPC: ${i}`);let r=i.trim().split(/\s+/),o=r.shift(),a=r;s&&(a={token:s,params:a}),t.debug(`Method: ${o}, params: ${a}`);try{return e.jsonrpc({id:n++,method:o,params:a}).then(u=>{let c=JSON.parse(u);if(t.debug(`Response: ${JSON.stringify(c)}`),c.error)throw new Error(c.error.message);return c.result})}catch(u){return t.error(u),u}}catch(r){return t.error(r),r}}}st.exports={JSONRPCClient:kt,Executor:L}});var ot=P(()=>{var{Executor:S}=J(),z=(T(),R(H)).default,m=new z("Terminal.js"),Pt=100,St=1e3,X=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.parentTerminal=null,this.commandHistory=[],this.historyIndex=-1;let e=localStorage.getItem("commandHistory");e&&(this.commandHistory=JSON.parse(e),m.debug(`Loading command history (${this.commandHistory.length} items)`),this.historyIndex=this.commandHistory.length),this.inputHandler=this.inputHandler.bind(this),this.reset=this.reset.bind(this),this.addEventListener("terminal-reset",this.reset);let n=function(){m.debug("DOMContentLoaded event fired"),this.reset(new CustomEvent("terminal-reset",{detail:{clear:!0}})),document.removeEventListener("DOMContentLoaded",n)}.bind(this);document.addEventListener("DOMContentLoaded",n)}connectedCallback(){m.debug("Terminal connected")}disconnectedCallback(){m.debug("Terminal disconnected"),this.inputLine.removeEventListener("keydown",this.inputHandler),this.removeEventListener("click",this.focusHandler)}reset(e){if(m.debug(`Terminal reset (${this.parentTerminal?"sub-terminal":"main terminal"})`),m.debug(`Auth state: ${this.authState}, RPC enabled: ${this.rpcEnabled}`),this.rpcEnabled&&this.authState!==S.OK)m.debug("logging in"),this.loginModal();else{let n=e.detail?.clear??!1;m.debug(`reset ${n?"and clear ":""}terminal`),this.uiModal(n)}this.focusHandler=function(){this.inputLine.focus()}.bind(this),this.addEventListener("click",this.focusHandler),this.focusHandler()}applyStyles(){let e=this.querySelector("style").cloneNode(!0);this.shadowRoot.appendChild(e)}loginModal(){this.shadowRoot.innerHTML="",this.applyStyles();let e=this.querySelector("template#login").content.cloneNode(!0);this.shadowRoot.appendChild(e),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.output=this.shadowRoot.querySelector(".output"),this.echo("Please log in");let n,i,s=async r=>{if(r.key==="Enter"){r.preventDefault();let o=(this.inputLine.value??this.inputLine.textContent).trim();if(n===void 0?n=o:i=o,n&&i)try{if(this.authState=await this.executor.login(n,i),m.debug(`Login state: ${this.authState}`),this.authState===S.NOTOKEN){this.loginModal(),this.focusHandler();return}this.inputLine.removeEventListener("keydown",s),this.removeEventListener("click",this.focusHandler),this.reset(new CustomEvent("terminal-reset",{detail:{clear:!0}}))}catch(a){this.echo(a),m.error(a)}else{m.debug(`awaiting password for ${n}`);let a=document.createElement("input");a.type="password",a.classList.add("input-line"),this.inputLine.textContent=this.inputLine.value="",this.inputLine.removeEventListener("keydown",s),this.removeEventListener("click",this.focusHandler),this.inputLine.replaceWith(a),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.prompt="password:",this.inputLine.addEventListener("keydown",s),this.addEventListener("click",this.focusHandler),this.focusHandler()}}};this.inputLine.addEventListener("keydown",s)}uiModal(e){let n=this.shadowRoot.querySelector(".output")?.innerHTML;this.shadowRoot.innerHTML="",this.applyStyles();let i=this.querySelector("template#ui").content.cloneNode(!0);this.shadowRoot.appendChild(i),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.output=this.shadowRoot.querySelector(".output"),e&&this.greeting?(m.debug("clearing terminal"),this.echo(this.greeting)):this.output.innerHTML=n??"",this.inputLine.addEventListener("keydown",this.inputHandler),this.inputLine.focus()}get executor(){return this._executor}set executor(e){m.info("Setting executor"),this._executor=e}get greeting(){return this.getAttribute("greeting")}set greeting(e){e===void 0?this.removeAttribute("greeting"):this.setAttribute("greeting",e)}get prompt(){return this.shadowRoot.querySelector(".prompt").textContent}set prompt(e){let n=this.shadowRoot.querySelector(".prompt");n.innerHTML=`${e}&nbsp;`}get rpcEnabled(){return this.getAttribute("rpc")==="true"}inputHandler(e){switch(e.key){case"Enter":{e.preventDefault();let n=this.inputLine.textContent.trim();this.inputLine.textContent="",this.echo(`${this.prompt}${n}`),this.processCommand(n);break}case"ArrowUp":m.debug(`History index (back): ${this.historyIndex}`),this.historyIndex>0&&(this.historyIndex-=1,this.inputLine.textContent=this.commandHistory[this.historyIndex]);break;case"ArrowDown":m.debug(`History index (forward): ${this.historyIndex}`),this.historyIndex<this.commandHistory.length-1?(this.historyIndex+=1,this.inputLine.textContent=this.commandHistory[this.historyIndex]):(this.historyIndex=this.commandHistory.length,this.inputLine.textContent="");break}}async processCommand(e){try{let n=await this.executor(e);switch(m.debug(`Status: ${n}`),n){case S.OK:m.debug(`${e} executed successfully`),e!==this.commandHistory[this.commandHistory.length-1]&&(this.commandHistory.push(e),this.commandHistory.length>Pt&&this.commandHistory.shift(),localStorage.setItem("commandHistory",JSON.stringify(this.commandHistory)),this.historyIndex=this.commandHistory.length);break;case S.ENOTFOUND:m.info(`${e} not found`);break;case S.ECMDERR:m.error(`Error executing ${e}`);break;case S.EBADARGS:m.warn(`${e} called with bad arguments`);break;default:m.error(`Unknown status: ${n} for ${e}`);break}}catch(n){m.error(n),this.echo(n)}}clear(){this.output.innerHTML=""}echo(e){for(e!=null&&e!==""&&(this.output.innerHTML+=`<div>${e}</div>`);this.output.children.length>St;)this.output.removeChild(this.output.firstChild);this.inputLine.getBoundingClientRect().bottom>window.innerHeight&&this.inputLine.scrollIntoView({behavior:"smooth"})}log(e){z.level==="debug"&&(typeof e=="string"?console.info(e):console.dir(e))}startSubTerminal(e){m.info(`Starting sub-terminal: ${e.name}`),this.removeEventListener("terminal-reset",this.reset);let n=new z(`Executor.js (${e.name})`),i=document.createElement("ng-terminal");return i.innerHTML=this.innerHTML,i.greeting=e.greeting,i.executor=S.bind(i)(n,e.registry),i.parentTerminal=this,this.replaceWith(i),i.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!0}})),e.prompt!==void 0&&(i.prompt=e.prompt),i}exitSubTerminal(){this.parentTerminal?(m.info("Exiting sub-terminal"),m.debug(`Parent terminal: ${JSON.stringify(this.parentTerminal)}`),this.parentTerminal.addEventListener("terminal-reset",this.parentTerminal.reset),this.replaceWith(this.parentTerminal),this.parentTerminal.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!1}}))):m.warn("No parent terminal found")}};customElements.define("ng-terminal",X)});var B=P((Bt,at)=>{var Ht=(T(),R(H)).default,M=new Ht("Renderer.js");function G(t,e){if(!new.target)return new G(...arguments);let n=t.pixels.toArray(),i=n.length,s=new Proxy(t,{get:function(r,o,a){if(M.silly(`getting ${o}`),typeof o=="string"&&!isNaN(o)){let u=+o;if(Number.isInteger(u)&&u>=0&&u<i)return M.silly(`get index ${u}, value ${n[u]}`),n[u]}else return Reflect.get(r,o,a)},set:function(r,o,a,u){if(M.silly(`setting ${o}`),typeof o=="string"&&!isNaN(o)){let c=+o;Number.isInteger(c)&&c>=0&&c<i&&(M.silly(`set index ${c}, value ${a}`),n[c]=Array.isArray(a)?e.color.apply(this,a):a)}else return Reflect.set(r,o,a,u)}});return t.loaded=!0,Object.defineProperties(s,{blit:{value:function(r,o){t.pixels.set(n),e.image(t,r,o)}},length:{value:n.length},update:{value:function(){M.debug("pixels updated"),t.pixels.set(n)}}}),s}function Y(t){if(!new.target)return new Y(...arguments);let e=0,n=[];Object.defineProperties(n,{flip:{value:function(){e^=1,M.debug(`flipped to ${e}`)}},read:{get:function(){return M.debug(`read selector: ${e}`),this[e^1]}},write:{get:function(){return M.debug(`write selector: ${e^1}`),this[e]}}});let i=t.createImage();n.push({buffer:i,get pixels(){return i.pixels.toArray()}});let s=t.createImage();n.push({buffer:s,get pixels(){return s.pixels.toArray()}}),Object.defineProperties(this,{flip:{value:function(){M.debug("flip buffers");let o=n.write.buffer;o.update(),t.background(o),n.flip()}},readBuffer:{get:function(){return M.debug(`get read buffer (${e})`),n.read.pixels}},writeBuffer:{get:function(){return n.write.buffer}}})}function j(t){if(j.instance!==void 0)return j.instance;if(!new.target)return new j(...arguments);let e=o=>{o.background(10,17,10),o.frameRate(60),o.noLoop()},n=()=>{},i=()=>{switch(s.keyCode){case s.UP:s.loop();break;case s.DOWN:s.noLoop();break;case s.LEFT:s.save("image.png");break;case s.RIGHT:s.redraw()}},s=new Processing(t,o=>{M.info("Processing.js created"),M.debug(`canvas width (${t.width}) height (${t.height})`),o.size(t.width,t.height),M.debug(`pjs width (${o.width}) height (${o.height})`),Object.defineProperties(o,{draw:{get:function(){return n}},keyPressed:{get:function(){return i}},setup:{get:function(){return e.bind(this,o)}}})});Object.defineProperties(this,{createImage:{value:function(o,a){let u=s.createImage(o??t.width,a??t.height,s.WEBGL);return new G(u,s)}},draw:{set:function(o){M.debug("drawFn set"),n=o}},doubleBuffer:{value:function(){return new Y(this)}},init:{value:()=>s.setup()},input:{set:function(o){M.debug("keyFn set"),i=o}},setup:{set:function(o){M.debug("setupFn set"),e=o}}});let r=new Proxy(this,{get:function(o,a){return o[a]??s[a]}});return Object.defineProperty(j,"instance",{value:r}),r}at.exports={DoubleBuffer:Y,Image:G,Renderer:j}});var ht=P((Ut,ct)=>{function A(){if(A.instance instanceof A)return A.instance;if(!new.target)return new A(...arguments);Object.defineProperty(A,"instance",{value:this});let t=Math.PI/180;Object.defineProperties(this,{cos:{value:{},enumerable:!0},sin:{value:{},enumerable:!0}});for(let e=0;e<=360;++e)Object.defineProperty(this.cos,e,{value:Math.cos(e*t)}),Object.defineProperty(this.sin,e,{value:Math.sin(e*t)})}var Tt=Object.freeze({addColors:(...t)=>t.length===0?[]:t[0].map((e,n)=>Math.min(t.reduce((i,s)=>i+s[n],0),255)),decodeColor:t=>[t>>16&255,t>>8&255,t&255,t>>>24],distance:(t,e,n,i)=>{let s=Math.abs(n-t),r=Math.abs(i-e);return Math.sqrt(s*s+r*r)},fastInvSqrt:()=>1,fastTrig:A(),range:(t,e)=>{let n=Math.random()*(e-t+1);return Number.isInteger(t)&&Number.isInteger(e)&&(n=Math.floor(n)),n+t},roll:t=>Math.floor(Math.random()*t)});ct.exports=Tt});var dt=P((_t,lt)=>{function ut(t,e){if(!new.target)return new ut(...arguments);let n=2,i=new s;i.next=new s,i.prev=i.next,i.prev.next=i,i.prev.prev=i,i.active=!1,i.prev.active=!1,this.acceleration=[0,.25],this.elasticity=.2,this.MAX_COUNT=3e3,Object.defineProperties(this,{createParticle:{value:function(r,o,a,u,c,d,f,y,p){if(i.prev.active){if(n>=this.MAX_COUNT)return;let g=new s(r,o,a,u,c,d,f,y,p);g.next=i,g.prev=i.prev,g.prev.next=g,i.prev=g,i=g,++n}else{let g=i.prev;g.activate(r,o,a,u,c,d,f,y,p),i=g}}},render:{value:function(){let r=i;for(;r.active;){e.apply(r),t.stroke(r.r,r.g,r.b,r.a),t.point(r.x,r.y);let o=r;if(r.ttl>0&&++r.t>=r.ttl&&(r.active=!1),r=r.next,r===i)break;o.active||(o===i?i=o.next:(o.next.prev=o.prev,o.prev.next=o.next,o.next=i,o.prev=i.prev,i.prev.next=o,i.prev=o))}}}});function s(r,o,a,u,c,d,f,y,p){if(!(this instanceof s))return new s(r,o,a,u,c,d,f,y,p);Object.defineProperties(this,{activate:{value:function(g,b,x,v,$,F,D,C,N){this.active=!0,this.ttl=g,this.t=0,this.x=b,this.y=x,this.dx=v,this.dy=$,this.ddx=0,this.ddy=0,this.dddx=0,this.dddy=0,this.r=F,this.g=D,this.b=C,this.a=N}}}),this.activate(r,o,a,u,c,d,f,y,p)}}lt.exports=ut});var gt=P((Kt,pt)=>{var w=ht(),k=dt(),h=B().Renderer();function ft(t,e,n,i){let s=i%t,r=Math.floor(i/t),o=n,a=Math.floor(s/e)%2==0,u=Math.floor(r/e)%2==0;return a!=u&&(o=0),[o,o,o,255]}var At={bz:function(){let t=h.width,e=Array.from({length:8},()=>Math.random()*t),n=Array.from({length:8},()=>Math.random()*t),i=Array.from({length:8},()=>Math.random()*15);h.background(255),h.noFill(),h.draw=function(){h.stroke(0,0,0,20),e.map(function(s,r,o){let a=s+i[r];a<0?(a=0,i[r]*=-1):a>t&&(a=t,i[r]*=-1),o[r]=a}),h.bezier.apply(null,e),h.stroke(255,128,128,20),n.map(function(s,r,o){let a=s+i[r];a<0?(a=0,i[r]*=-1):a>t&&(a=t,i[r]*=-1),o[r]=a}),h.bezier.apply(null,n)},h.loop()},chaos:function(t="3"){h.frameRate(400);let e=h.width,n=h.height,i=e/2,s=n/2,r=i-50,o=Math.PI/180,a={3:[{x:e/2,y:50},{x:50,y:n-50},{x:e-50,y:n-50}],5:[{x:e-50,y:50},{x:50,y:50},{x:50,y:n-50},{x:e-50,y:n-50},{x:i,y:s}],6:[{x:Math.cos(0)*r+i,y:Math.sin(0)*r+s},{x:Math.cos(60*o)*r+i,y:Math.sin(60*o)*r+s},{x:Math.cos(120*o)*r+i,y:Math.sin(120*o)*r+s},{x:Math.cos(180*o)*r+i,y:Math.sin(180*o)*r+s},{x:Math.cos(240*o)*r+i,y:Math.sin(240*o)*r+s},{x:Math.cos(300*o)*r+i,y:Math.sin(300*o)*r+s}]}[t],u={3:2,5:1.5,6:1.5}[t];h.background(0),h.stroke(255,255,255,255);for(let{x:f,y}of a)h.point(f,y);let c=Math.random()*e,d=Math.random()*n;h.draw=function(){let f=w.roll(a.length);c+=(a[f].x-c)/u,d+=(a[f].y-d)/u,h.point(c,d)},h.loop()},fire:function(){let t=h.width,e=h.doubleBuffer(),n=e.writeBuffer;for(let r=0;r<n.length;++r)n[r]=[0,0,0,255];e.flip(),n=e.writeBuffer;for(let r=0;r<n.length;++r)n[r]=[0,0,0,255];e.flip();let i=e.readBuffer.length/t,s=h.color(255,128,96);h.draw=function(){let r=e.readBuffer,o=e.writeBuffer;for(let a=t;a<o.length-t;++a){if(a%t<1||a%t>=t-1)continue;let u=a/t;if(Math.random()<Math.pow(Math.E,Math.pow(u/i,4))-.9925&&Math.random()>.975){o[a]=s;continue}let c=w.addColors(w.decodeColor(r[a-1]),w.decodeColor(r[a]),w.decodeColor(r[a+1]),w.decodeColor(r[a+t])).map((d,f)=>f===3?d:d/4);o[a]=c}e.flip()},h.loop()},fireworks:function(){let t=h.width,e=h.height,n=new k(h,function(){this.dx+=n.acceleration[0],this.dy+=n.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.g=255*c*c,this.b=255*c*c*c*c,this.a=255*c}),i=new k(h,function(){this.dx+=i.acceleration[0],this.dy+=i.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.b=255*Math.pow(c,.2),this.g=255*c*c,this.r=255*c*c*c*c,this.a=255*c}),s=new k(h,function(){this.dx+=s.acceleration[0],this.dy+=s.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.g=255*Math.pow(c,.2),this.r=255*c*c,this.b=255*c*c*c*c,this.a=255*c}),r=new k(h,function(){this.dx+=r.acceleration[0],this.dy+=r.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.g=255*Math.pow(c,.2),this.b=255*c*c*c*c,this.a=255*c}),o=new k(h,function(){this.dx+=o.acceleration[0],this.dy+=o.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.b=255*c*c*c*c,this.g=255*c,this.a=255*c}),a=new k(h,function(){this.dx+=a.acceleration[0],this.dy+=a.acceleration[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.b=255*Math.pow(c,.2),this.g=255*c*c*c*c,this.a=255*c});n.acceleration=[0,.15],i.acceleration=[0,.15],s.acceleration=[0,.15],r.acceleration=[0,.15],o.acceleration=[0,.15],a.acceleration=[0,.15];function u(c,d){let f;switch(w.range(0,5)){case 0:f=n;break;case 1:f=i;break;case 2:f=s;break;case 3:f=r;break;case 4:f=a;break;case 5:f=o;break}for(let y=0;y<300;++y){let p=w.range(0,Math.PI*2),g=w.range(.001,10);f.createParticle(w.range(50.001,100),c,d,Math.cos(p)*g,Math.sin(p)*g,0,0,0,0)}}h.draw=function(){h.background(0),Math.random()>.95&&u(w.range(.001,t),w.range(.001,e/2)),n.render(),i.render(),s.render(),r.render(),a.render(),o.render()},h.loop()},fountain:function(){let t=h.width,e=h.height,n=new k(h,function(){this.dx+=n.acceleration[0],this.dy+=n.acceleration[1],this.x+=this.dx,this.y+=this.dy;let s=1-this.t/this.ttl;this.r=255*Math.pow(s,.2),this.g=255*s*s,this.b=255*s*s*s*s,this.a=255*Math.pow(s,.2),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-2?(this.dy<.25?this.y=e-1:this.y=e-2,this.dy*=-1.2*Math.random()*n.elasticity,Math.random()<.5?this.dx-=this.dy:this.dx+=this.dy):this.y<0&&(this.y=0,this.dy*=-1*n.elasticity),this.y===e-1&&(this.active=!1)}),i=-20;h.draw=function(){h.background(0);for(let s=0;s<15;++s){let r=w.range(-.098,.098),o=w.range(i,.8*i);n.createParticle(w.range(10,30)*-o,t/2,e-20,Math.sin(r)*o,Math.cos(r)*o,0,0,0,0)}n.render()},h.loop()},lens:function(t=150,e=30){t=+t,e=+e;let n=()=>{},i=h.width,s=h.createImage(),r=s.height;for(let x=0;x<s.length;++x)s[x]=ft(r,r/32,255,x);s.update();let o=h.createImage(t,t),a=new Array(t*t).fill(0),u=Math.round(t/2),c=u*u,d=u*(t+1),f;for(let x=0;x<c;++x){let v=x%u,$=Math.floor(x/u),F=v*v,D=$*$,C=0,N=0;if(F+D<c){let Z=e/Math.sqrt(e*e-(F+D-c));C=Math.floor(v*Z)-v,N=Math.floor($*Z)-$}f=N*i+C,a[d-$*t-v]=-f,a[d+$*t+v]=f,f=-N*i+C,a[d-$*t+v]=f,a[d+$*t-v]=-f}let y=i/2,p=i/2,g=1,b=2;h.draw=function(){n("update"),y+=g,p+=b,n("check"),y<0&&(y=0,g=-g),y>i-t&&(y=i-t,g=-g),p<0&&(p=0,b=-b),p>i-t&&(p=i-t,b=-b),n("draw"),h.background(s);let x=p*i+y;for(let v=0;v<t*t;++v)o[v]=s[Math.round(x)+Math.floor(v/t)*i+v%t+a[v]];o.blit(y,p)},h.loop()},life:function(){h.frameRate(12);let t=h.width,e=h.height,n=.05,i=0,s=1,r=1,o=0,a=-1,u=Array.from(Array(t*e)).map(()=>Array.from(Array(2)));u.forEach(d=>{d[i]=o,d[s]=Math.random()<n?r:o});function c(d){let f=d%t,y=Math.floor(d/t),p=0;return y>0&&(f>0&&(p+=u[d-t-1][i]),f<t-1&&(p+=u[d-t+1][i]),p+=u[d-t][i]),y<e-1&&(f>0&&(p+=u[d+t-1][i]),f<t-1&&(p+=u[d+t+1][i]),p+=u[d+t][i]),f>0&&(p+=u[d-1][i]),f<t-1&&(p+=u[d+1][i]),p}h.stroke(255),h.draw=function(){h.background(0),u.forEach((d,f)=>{let y=u[f];if(d[s]===r||d[i]===r){y[i]=r;let x=f%t,v=f/t;h.point(x,v)}d[s]===a&&(y[i]=o),y[s]=o;let p=f-3*t;if(p<0)return;let g=u[p],b=c(p);b===3&&g[i]===o&&(g[s]=r),(b<2||b>3)&&g[i]===r&&(g[s]=a)})},h.loop()},pattern:function(){let t=h.createImage(),e=t.height;for(let n=0;n<t.length;++n)t[n]=ft(e,e/8,255,n);t.update(),h.background(t)},snow:function(){let t=h.width,e=h.height,n=new k(h,function(){this.x+=this.dx,this.y+=this.dy,(this.x>=t-1||this.y>=e-1||this.y<0)&&(this.active=!1)});h.draw=function(){h.background(0),n.createParticle(0,w.range(-t/2,t-1),0,w.range(0,.25),w.range(.4,.6),255,255,255,w.range(96,255)),n.render()},h.loop()},stars:function(){let t=h.width,e=h.height,n=t/2,i=e/2,s=n*.75,r=new k(h,function(){this.x+=this.dx,this.y+=this.dy,(this.x>=t-1||this.y>=e-1||this.x<0||this.y<0)&&(this.active=!1);let o=Math.sqrt(this.dx*this.dx+this.dy*this.dy),a=Math.min(w.distance(this.x,this.y,n,i),n);this.a=64*(1-a/s)+255*(o*this.t++/s)+64*(o/6)});h.draw=function(){h.background(0);for(let o=0;o<20;++o){let a=w.roll(t),u=w.roll(e);a=(a+w.roll(t))/2,u=(u+w.roll(e))/2;let c=Math.min(w.distance(a,u,n,i),n),d=-Math.atan((i-u)/(a-n));a<n&&(d+=Math.PI);let f=5*(1-c/n)+1;r.createParticle(0,a,u,Math.cos(d)*f,Math.sin(d)*f,255,255,255,0)}r.render()},h.loop()}};pt.exports=At});var wt=P((Jt,mt)=>{var V=gt(),Ct=B().Renderer(),yt=Object.freeze({clear:{func:function(){this.clear()}},help:{func:function(){this.echo("Available commands:"),Object.keys(yt).forEach(t=>this.echo(t))}},load:{func:function(t,...e){this.echo(`Loading ${t}\u2026`),t in V&&(Ct.init(),V[t].apply(this,e))}},ls:{func:function(){this.echo("Available demos:"),Object.keys(V).forEach(t=>this.echo(t))}}});mt.exports=yt});var bt=(T(),R(H)).default,{Executor:Nt}=J();ot();var{Renderer:Rt}=B(),Q=new bt("index.js");window.addEventListener("load",()=>{Q.info("Creating renderer");let t=document.querySelector("canvas"),e=t.getBoundingClientRect();t.width=e.width,t.height=e.height,Q.debug(`initial canvas width (${t.width}) height (${t.height})`),Rt(t),Q.info("Creating executor");let n=document.querySelector("ng-terminal"),i=new bt("Executor.js");n.executor=Nt.bind(n)(i,wt())});})();
