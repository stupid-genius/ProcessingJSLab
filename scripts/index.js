(()=>{var wt=Object.defineProperty;var pe=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var xe=Object.prototype.hasOwnProperty;var at=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,i)=>(typeof require<"u"?require:e)[i]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var me=(t,e)=>()=>(t&&(e=t(t=0)),e);var j=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),ve=(t,e)=>{for(var i in e)wt(t,i,{get:e[i],enumerable:!0})},we=(t,e,i,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ye(e))!xe.call(t,s)&&s!==i&&wt(t,s,{get:()=>e[s],enumerable:!(r=pe(e,s))||r.enumerable});return t};var ht=t=>we(wt({},"__esModule",{value:!0}),t);var et={};ve(et,{APITransport:()=>Ft,ConsoleTransport:()=>bt,FileTransport:()=>$t,default:()=>U,interpolate:()=>Ht});function U(t){if(t===void 0)throw new Error("Logger requires the file name of where it's being used.");if(!new.target)return new U(...arguments);Object.defineProperties(this,{log:{value:function(e,i,r){ct.indexOf(e)<=ct.indexOf(U.state.currentLevel)&&Object.values(U.state.transports).forEach(s=>{queueMicrotask(()=>s.log({level:e,msg:i,category:t,...r}))})}}}),ct.forEach(e=>{let i;e==="noop"?i=()=>{}:i=this.log.bind(this,e),Object.defineProperty(this,e,{value:i})})}function bt(t){if(!new.target)return new bt(...arguments);Object.defineProperty(this,"log",{value:function(e){let i=Object.assign({},t,e);if(i.isTable)console.table(i.msg,i.args);else if(i.group)console[i.group](i.msg);else{let[r,s]=i.style?.length===2?i.style:["font-weight: bold; color: green;","font-style: italic;"];console[i.level](`%c${i.timestamp||new Date().toLocaleTimeString("en-US",i.dateFmt)}%c %c[${i.category}]%c ${i.msg}`,r,"",s,"",...i.args||[])}}})}function $t(t){if(window.showSaveFilePicker===void 0){let e="FileTransport requires the File System Access API";throw console.warn(e),new Error(e)}if(!new.target)return new $t(...arguments);Object.defineProperty(this,"initialize",{value:async function(){try{let e=await window.showSaveFilePicker({types:[{description:"Log Files",accept:{"text/plain":[".log"]}}]});Object.defineProperty(this,"log",{value:async function(i){let r=Object.assign({},t,i),s;try{s=await e.createWritable({keepExistingData:!0}),await s.write(`${r.timestamp||new Date().toLocaleTimeString("en-US",r.dateFmt)} [${r.category}] ${r.level}: ${r.msg}
`)}catch(c){console.error(c)}finally{await s.close()}}})}catch(e){console.error(e)}}})}function Ft(t){if(!new.target)return new Ft(...arguments);Object.defineProperty(this,"log",{value:async function(e){let i=Ht(t,e);try{let r=await fetch(i.url,{method:i.method,headers:Object.entries(i.headers||{}).reduce((s,[c,a])=>(s[c]=a,s),{}),body:i.body});console.debug(r)}catch(r){console.error(r)}}})}var ct,Ht,it=me(()=>{ct=["noop","error","warn","info","debug","silly"];Object.defineProperties(U,{addTransport:{value:(t,e)=>{U.state.transports[t]=e}},state:{value:{currentLevel:"noop",transports:{}}},level:{get:()=>U.state.currentLevel},removeTransport:{value:t=>{delete U.state.transports[t]}},setLogLevel:{value:t=>{if(ct.some(e=>e===t))U.state.currentLevel=t;else throw new Error(`${t} is not a valid logger level`)}}});U.addTransport("default",bt({}));ct.reduce((t,e)=>(Object.defineProperty(t,e.toUpperCase(),{enumerable:!0,get:()=>e}),t),U);Ht=function t(e,i){if(e instanceof Object){let r=Array.isArray(e)?[]:{};for(let s in e){let c=t(e[s],i);try{r[s]=JSON.parse(c)}catch{c!==void 0&&c!==""&&(r[s]=c)}}return r}return typeof e!="string"?e:e.replace(/\{\{(.+?)}}/g,(r,s)=>{let c=i[s]||"";return c instanceof Object?JSON.stringify(c):c})}});var Xt=j((_e,qt)=>{var Mt;typeof window>"u"?Mt=(it(),ht(et)):Mt=(it(),ht(et)).default;var be=new Mt("getopt.js"),Dt=function(t){be.warn(t)};function k(t,e){typeof k.place>"u"&&(k.place="",k.iplace=0);let i;if(k.optreset>0||k.iplace===k.place.length){if(k.optreset=0,k.place=t[k.optind],k.iplace=0,k.optind>=t.length||k.place.charAt(k.iplace++)!=="-")return k.place="",k.iplace=0,"";if(k.optopt=k.place.charAt(k.iplace++),k.optopt==="-"&&k.iplace===k.place.length)return++k.optind,k.getopt.place="",k.getopt.iplace=0,"";if(k.optopt===0){if(k.place="",k.iplace=0,e.indexOf("-")===-1)return"";k.optopt="-"}}else k.optopt=k.place.charAt(k.iplace++);if(k.optopt===":"||(i=e.indexOf(k.optopt))===-1)return k.iplace===k.place.length&&++k.optind,k.opterr&&e.charAt(0)!==":"&&Dt("illegal option -- "+k.optopt),"?";if(e.charAt(i+1)!==":")k.optarg=null,k.iplace===k.place.length&&++k.optind;else{if(k.iplace<k.place.length)k.optarg=k.place.substr(k.iplace);else if(t.length>++k.optind)k.optarg=t[k.optind];else return k.place="",k.iplace=0,e.charAt(0)===":"?":":k.opterr?(Dt("option requires an argument -- "+k.optopt),":"):"?";k.place="",k.iplace=0,++k.optind}return k.optopt}k.opterr=1;k.optind=0;k.optopt="";k.optreset=0;k.optarg="";qt.exports=k});var Et=j((Ne,Wt)=>{var B=Xt();function Y(t,e,i){if(typeof e=="function")return function(){return e.apply(this,arguments)||Y.OK};let r=this;r.echo===void 0&&(r.echo=t.info);let s=[],c=/"([^"]*)"|'([^']*)'|\S+/g,a=async function(h){t.info(`Executing: ${h}`);let g=h.match(c).map(p=>p.replace(/^['"]|['"]$/g,"")),v=g.shift(),f=e[v];if(f===void 0){if(s.includes(v))try{let p=JSON.stringify(await i(h));return t.debug(`RPC Response: ${p}`),r.echo(p),Y.OK}catch(p){return r.echo(p),Y.ECMDERR}return r.echo(`${v}: no such command`),Y.ENOTFOUND}let{func:o,opts:l,usage:d}=f,u=l;if(d&&(u=u?`${u}h`:"h"),u!==void 0){t.debug(`Parsing options: ${u} with ${g}`);let p={},w;for(B.optreset=1,B.optind=0;(w=B(g,u))!=="";)switch(t.debug(`Opt: ${w}, optarg: ${B.optarg}, optind: ${B.optind}`),w){case"h":return r.echo(`Usage: ${d}`),Y.OK;case":":return r.echo(`${B.optopt}: option needs a value`),Y.EBADARGS;case"?":return r.echo(`${B.optopt}: no such option`),Y.EBADARGS;default:t.debug(`Switch: ${w}, optarg: ${B.optarg}`),p[w]=B.optarg||!0}o.opts=p,t.debug(`Switches: ${JSON.stringify(p)}`)}else B.optind=0;return t.debug(`Terms: ${g}`),await o.apply(this,g.slice(B.optind))??Y.OK};return i!==void 0&&queueMicrotask(async function(){let h=await i("system.describe");t.debug(`system.describe result: ${h}`),JSON.parse(h).procs.forEach(g=>s.push(g)),e.help.rpcList=s,t.debug(`RPC List: ${s}`),Object.defineProperties(a,{login:{value:async function(g,v){t.info(`Attempting to log in user ${g}`);try{let f=await i(`login ${g} ${v}`);if(f===!1)return r.echo("Login failed"),Y.NOTOKEN;let o=i;return a.exit??Object.defineProperty(a,"exit",{value:async function(){t.info("Logging out"),i=o,r.authState=Y.NOTOKEN,r.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!0}}))}}),i=new Proxy(i,{apply:function(l,d,u){return l(u[0],f)}}),Y.OK}catch(f){return t.error(f),f}}}})}),a}var lt=0;Object.defineProperties(Y,{OK:{value:lt++},ENOTFOUND:{value:lt++},ECMDERR:{value:lt++},EBADARGS:{value:lt++},NOTOKEN:{value:lt++}});function Me(t,e){let i=0;return function(r,s){try{t.info(`Executing RPC: ${r}`);let c=r.trim().split(/\s+/),a=c.shift(),h=c;s&&(h={token:s,params:h}),t.debug(`Method: ${a}, params: ${h}`);try{return e.jsonrpc({id:i++,method:a,params:h}).then(g=>{let v=JSON.parse(g);if(t.debug(`Response: ${JSON.stringify(v)}`),v.error)throw new Error(v.error.message);return v.result})}catch(g){return t.error(g),g}}catch(c){return t.error(c),c}}}Wt.exports={JSONRPCClient:Me,Executor:Y}});var Yt=j(()=>{var{Executor:J}=Et(),kt=(it(),ht(et)).default,_=new kt("Terminal.js"),Ee=100,ke=1e3,At=class extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.parentTerminal=null,this.commandHistory=[],this.historyIndex=-1;let e=localStorage.getItem("commandHistory");e&&(this.commandHistory=JSON.parse(e),_.debug(`Loading command history (${this.commandHistory.length} items)`),this.historyIndex=this.commandHistory.length),this.inputHandler=this.inputHandler.bind(this),this.reset=this.reset.bind(this),this.addEventListener("terminal-reset",this.reset);let i=function(){_.debug("DOMContentLoaded event fired"),this.reset(new CustomEvent("terminal-reset",{detail:{clear:!0}})),document.removeEventListener("DOMContentLoaded",i)}.bind(this);document.addEventListener("DOMContentLoaded",i)}connectedCallback(){_.debug("Terminal connected")}disconnectedCallback(){_.debug("Terminal disconnected"),this.inputLine.removeEventListener("keydown",this.inputHandler),this.removeEventListener("click",this.focusHandler)}reset(e){if(_.debug(`Terminal reset (${this.parentTerminal?"sub-terminal":"main terminal"})`),_.debug(`Auth state: ${this.authState}, RPC enabled: ${this.rpcEnabled}`),this.rpcEnabled&&this.authState!==J.OK)_.debug("logging in"),this.loginModal();else{let i=e.detail?.clear??!1;_.debug(`reset ${i?"and clear ":""}terminal`),this.uiModal(i)}this.focusHandler=function(){this.inputLine.focus()}.bind(this),this.addEventListener("click",this.focusHandler),this.focusHandler()}applyStyles(){let e=this.querySelector("style").cloneNode(!0);this.shadowRoot.appendChild(e)}loginModal(){this.shadowRoot.innerHTML="",this.applyStyles();let e=this.querySelector("template#login").content.cloneNode(!0);this.shadowRoot.appendChild(e),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.output=this.shadowRoot.querySelector(".output"),this.echo("Please log in");let i,r,s=async c=>{if(c.key==="Enter"){c.preventDefault();let a=(this.inputLine.value??this.inputLine.textContent).trim();if(i===void 0?i=a:r=a,i&&r)try{if(this.authState=await this.executor.login(i,r),_.debug(`Login state: ${this.authState}`),this.authState===J.NOTOKEN){this.loginModal(),this.focusHandler();return}this.inputLine.removeEventListener("keydown",s),this.removeEventListener("click",this.focusHandler),this.reset(new CustomEvent("terminal-reset",{detail:{clear:!0}}))}catch(h){this.echo(h),_.error(h)}else{_.debug(`awaiting password for ${i}`);let h=document.createElement("input");h.type="password",h.classList.add("input-line"),this.inputLine.textContent=this.inputLine.value="",this.inputLine.removeEventListener("keydown",s),this.removeEventListener("click",this.focusHandler),this.inputLine.replaceWith(h),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.prompt="password:",this.inputLine.addEventListener("keydown",s),this.addEventListener("click",this.focusHandler),this.focusHandler()}}};this.inputLine.addEventListener("keydown",s)}uiModal(e){let i=this.shadowRoot.querySelector(".output")?.innerHTML;this.shadowRoot.innerHTML="",this.applyStyles();let r=this.querySelector("template#ui").content.cloneNode(!0);this.shadowRoot.appendChild(r),this.inputLine=this.shadowRoot.querySelector(".input-line"),this.output=this.shadowRoot.querySelector(".output"),e&&this.greeting?(_.debug("clearing terminal"),this.echo(this.greeting)):this.output.innerHTML=i??"",this.inputLine.addEventListener("keydown",this.inputHandler),this.inputLine.focus()}get executor(){return this._executor}set executor(e){_.info("Setting executor"),this._executor=e}get greeting(){return this.getAttribute("greeting")}set greeting(e){e===void 0?this.removeAttribute("greeting"):this.setAttribute("greeting",e)}get prompt(){return this.shadowRoot.querySelector(".prompt").textContent}set prompt(e){let i=this.shadowRoot.querySelector(".prompt");i.innerHTML=`${e}&nbsp;`}get rpcEnabled(){return this.getAttribute("rpc")==="true"}inputHandler(e){switch(e.key){case"Enter":{e.preventDefault();let i=this.inputLine.textContent.trim();this.inputLine.textContent="",this.echo(`${this.prompt}${i}`),this.processCommand(i),this.historyIndex=this.commandHistory.length;break}case"ArrowUp":_.debug(`History index (back): ${this.historyIndex}`),this.historyIndex>0&&(this.historyIndex-=1,this.inputLine.textContent=this.commandHistory[this.historyIndex]);break;case"ArrowDown":_.debug(`History index (forward): ${this.historyIndex}`),this.historyIndex<this.commandHistory.length-1?(this.historyIndex+=1,this.inputLine.textContent=this.commandHistory[this.historyIndex]):(this.historyIndex=this.commandHistory.length,this.inputLine.textContent="");break}}async processCommand(e){try{let i=await this.executor(e);switch(_.debug(`Status: ${i}`),i){case J.OK:_.debug(`${e} executed successfully`),e!==this.commandHistory[this.commandHistory.length-1]&&(this.commandHistory.push(e),this.commandHistory.length>Ee&&this.commandHistory.shift(),localStorage.setItem("commandHistory",JSON.stringify(this.commandHistory)));break;case J.ENOTFOUND:_.info(`${e} not found`);break;case J.ECMDERR:_.error(`Error executing ${e}`);break;case J.EBADARGS:_.warn(`${e} called with bad arguments`);break;default:_.error(`Unknown status: ${i} for ${e}`);break}}catch(i){_.error(i),this.echo(i)}}clear(){this.output.innerHTML=""}echo(e){for(e!=null&&e!==""&&(this.output.innerHTML+=`<div>${e}</div>`);this.output.children.length>ke;)this.output.removeChild(this.output.firstChild);this.inputLine.getBoundingClientRect().bottom>window.innerHeight&&this.inputLine.scrollIntoView({behavior:"smooth"})}log(e){kt.level==="debug"&&(typeof e=="string"?console.info(e):console.dir(e))}startSubTerminal(e){_.info(`Starting sub-terminal: ${e.name}`),this.removeEventListener("terminal-reset",this.reset);let i=new kt(`Executor.js (${e.name})`),r=document.createElement("ng-terminal");return r.innerHTML=this.innerHTML,r.greeting=e.greeting,r.executor=J.bind(r)(i,e.registry),r.parentTerminal=this,this.replaceWith(r),r.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!0}})),e.prompt!==void 0&&(r.prompt=e.prompt),r}exitSubTerminal(){this.parentTerminal?(_.info("Exiting sub-terminal"),_.debug(`Parent terminal: ${JSON.stringify(this.parentTerminal)}`),this.parentTerminal.addEventListener("terminal-reset",this.parentTerminal.reset),this.replaceWith(this.parentTerminal),this.parentTerminal.dispatchEvent(new CustomEvent("terminal-reset",{detail:{clear:!1}}))):_.warn("No parent terminal found")}};customElements.define("ng-terminal",At)});var Bt=j((Ut,Lt)=>{(function(t){if(typeof Ut=="object"&&typeof Lt<"u")Lt.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e;typeof window<"u"?e=window:typeof global<"u"?e=global:typeof self<"u"?e=self:e=this,e.GIF=t()}})(function(){var t,e,i;return function r(s,c,a){function h(f,o){if(!c[f]){if(!s[f]){var l=typeof at=="function"&&at;if(!o&&l)return l(f,!0);if(g)return g(f,!0);var d=new Error("Cannot find module '"+f+"'");throw d.code="MODULE_NOT_FOUND",d}var u=c[f]={exports:{}};s[f][0].call(u.exports,function(p){var w=s[f][1][p];return h(w||p)},u,u.exports,r,s,c,a)}return c[f].exports}for(var g=typeof at=="function"&&at,v=0;v<a.length;v++)h(a[v]);return h}({1:[function(r,s,c){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}s.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(o){if(!g(o)||o<0||isNaN(o))throw TypeError("n must be a positive number");return this._maxListeners=o,this},a.prototype.emit=function(o){var l,d,u,p,w,y;if(this._events||(this._events={}),o==="error"&&(!this._events.error||v(this._events.error)&&!this._events.error.length)){if(l=arguments[1],l instanceof Error)throw l;var x=new Error('Uncaught, unspecified "error" event. ('+l+")");throw x.context=l,x}if(d=this._events[o],f(d))return!1;if(h(d))switch(arguments.length){case 1:d.call(this);break;case 2:d.call(this,arguments[1]);break;case 3:d.call(this,arguments[1],arguments[2]);break;default:p=Array.prototype.slice.call(arguments,1),d.apply(this,p)}else if(v(d))for(p=Array.prototype.slice.call(arguments,1),y=d.slice(),u=y.length,w=0;w<u;w++)y[w].apply(this,p);return!0},a.prototype.addListener=function(o,l){var d;if(!h(l))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",o,h(l.listener)?l.listener:l),this._events[o]?v(this._events[o])?this._events[o].push(l):this._events[o]=[this._events[o],l]:this._events[o]=l,v(this._events[o])&&!this._events[o].warned&&(f(this._maxListeners)?d=a.defaultMaxListeners:d=this._maxListeners,d&&d>0&&this._events[o].length>d&&(this._events[o].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[o].length),typeof console.trace=="function"&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(o,l){if(!h(l))throw TypeError("listener must be a function");var d=!1;function u(){this.removeListener(o,u),d||(d=!0,l.apply(this,arguments))}return u.listener=l,this.on(o,u),this},a.prototype.removeListener=function(o,l){var d,u,p,w;if(!h(l))throw TypeError("listener must be a function");if(!this._events||!this._events[o])return this;if(d=this._events[o],p=d.length,u=-1,d===l||h(d.listener)&&d.listener===l)delete this._events[o],this._events.removeListener&&this.emit("removeListener",o,l);else if(v(d)){for(w=p;w-- >0;)if(d[w]===l||d[w].listener&&d[w].listener===l){u=w;break}if(u<0)return this;d.length===1?(d.length=0,delete this._events[o]):d.splice(u,1),this._events.removeListener&&this.emit("removeListener",o,l)}return this},a.prototype.removeAllListeners=function(o){var l,d;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[o]&&delete this._events[o],this;if(arguments.length===0){for(l in this._events)l!=="removeListener"&&this.removeAllListeners(l);return this.removeAllListeners("removeListener"),this._events={},this}if(d=this._events[o],h(d))this.removeListener(o,d);else if(d)for(;d.length;)this.removeListener(o,d[d.length-1]);return delete this._events[o],this},a.prototype.listeners=function(o){var l;return!this._events||!this._events[o]?l=[]:h(this._events[o])?l=[this._events[o]]:l=this._events[o].slice(),l},a.prototype.listenerCount=function(o){if(this._events){var l=this._events[o];if(h(l))return 1;if(l)return l.length}return 0},a.listenerCount=function(o,l){return o.listenerCount(l)};function h(o){return typeof o=="function"}function g(o){return typeof o=="number"}function v(o){return typeof o=="object"&&o!==null}function f(o){return o===void 0}},{}],2:[function(r,s,c){var a,h,g,v,f;f=navigator.userAgent.toLowerCase(),v=navigator.platform.toLowerCase(),a=f.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],g=a[1]==="ie"&&document.documentMode,h={name:a[1]==="version"?a[3]:a[1],version:g||parseFloat(a[1]==="opera"&&a[4]?a[4]:a[2]),platform:{name:f.match(/ip(?:ad|od|hone)/)?"ios":(f.match(/(?:webos|android)/)||v.match(/mac|win|linux/)||["other"])[0]}},h[h.name]=!0,h[h.name+parseInt(h.version,10)]=!0,h.platform[h.platform.name]=!0,s.exports=h},{}],3:[function(r,s,c){var a,h,g,v=function(d,u){for(var p in u)f.call(u,p)&&(d[p]=u[p]);function w(){this.constructor=d}return w.prototype=u.prototype,d.prototype=new w,d.__super__=u.prototype,d},f={}.hasOwnProperty,o=[].indexOf||function(d){for(var u=0,p=this.length;u<p;u++)if(u in this&&this[u]===d)return u;return-1},l=[].slice;a=r("events").EventEmitter,g=r("./browser.coffee"),h=function(d){var u,p;v(w,d),u={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},p={delay:500,copy:!1};function w(y){var x,m,b;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(y);for(m in u)b=u[m],(x=this.options)[m]==null&&(x[m]=b)}return w.prototype.setOption=function(y,x){if(this.options[y]=x,this._canvas!=null&&(y==="width"||y==="height"))return this._canvas[y]=x},w.prototype.setOptions=function(y){var x,m,b;m=[];for(x in y)f.call(y,x)&&(b=y[x],m.push(this.setOption(x,b)));return m},w.prototype.addFrame=function(y,x){var m,b;x==null&&(x={}),m={},m.transparent=this.options.transparent;for(b in p)m[b]=x[b]||p[b];if(this.options.width==null&&this.setOption("width",y.width),this.options.height==null&&this.setOption("height",y.height),typeof ImageData<"u"&&ImageData!==null&&y instanceof ImageData)m.data=y.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&y instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&y instanceof WebGLRenderingContext)x.copy?m.data=this.getContextData(y):m.context=y;else if(y.childNodes!=null)x.copy?m.data=this.getImageData(y):m.image=y;else throw new Error("Invalid image");return this.frames.push(m)},w.prototype.render=function(){var y,x,m,b;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var E,L,A;for(A=[],y=E=0,L=this.frames.length;0<=L?E<L:E>L;y=0<=L?++E:--E)A.push(null);return A}.call(this),m=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(y=x=0,b=m;0<=b?x<b:x>b;y=0<=b?++x:--x)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},w.prototype.abort=function(){for(var y;y=this.activeWorkers.shift(),y!=null;)this.log("killing active worker"),y.terminate();return this.running=!1,this.emit("abort")},w.prototype.spawnWorkers=function(){var y,x,m,b;return x=Math.min(this.options.workers,this.frames.length),function(){b=[];for(var E=m=this.freeWorkers.length;m<=x?E<x:E>x;m<=x?E++:E--)b.push(E);return b}.apply(this).forEach(function(E){return function(L){var A;return E.log("spawning worker "+L),A=new Worker(E.options.workerScript),A.onmessage=function(C){return E.activeWorkers.splice(E.activeWorkers.indexOf(A),1),E.freeWorkers.push(A),E.frameFinished(C.data)},E.freeWorkers.push(A)}}(this)),x},w.prototype.frameFinished=function(y){var x,m,b;if(this.log("frame "+y.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[y.index]=y,this.options.globalPalette===!0&&(this.options.globalPalette=y.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(x=m=1,b=this.freeWorkers.length;1<=b?m<b:m>b;x=1<=b?++m:--m)this.renderNextFrame();return o.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},w.prototype.finishRendering=function(){var y,x,m,b,E,L,A,C,R,P,O,S,F,D,I,T;for(C=0,D=this.imageParts,E=0,R=D.length;E<R;E++)x=D[E],C+=(x.data.length-1)*x.pageSize+x.cursor;for(C+=x.pageSize-x.cursor,this.log("rendering finished - filesize "+Math.round(C/1e3)+"kb"),y=new Uint8Array(C),S=0,I=this.imageParts,L=0,P=I.length;L<P;L++)for(x=I[L],T=x.data,m=A=0,O=T.length;A<O;m=++A)F=T[m],y.set(F,S),m===x.data.length-1?S+=x.cursor:S+=x.pageSize;return b=new Blob([y],{type:"image/gif"}),this.emit("finished",b,y)},w.prototype.renderNextFrame=function(){var y,x,m;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return y=this.frames[this.nextFrame++],m=this.freeWorkers.shift(),x=this.getTask(y),this.log("starting frame "+(x.index+1)+" of "+this.frames.length),this.activeWorkers.push(m),m.postMessage(x)},w.prototype.getContextData=function(y){return y.getImageData(0,0,this.options.width,this.options.height).data},w.prototype.getImageData=function(y){var x;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),x=this._canvas.getContext("2d"),x.setFill=this.options.background,x.fillRect(0,0,this.options.width,this.options.height),x.drawImage(y,0,0),this.getContextData(x)},w.prototype.getTask=function(y){var x,m;if(x=this.frames.indexOf(y),m={index:x,last:x===this.frames.length-1,delay:y.delay,transparent:y.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:g.name==="chrome"},y.data!=null)m.data=y.data;else if(y.context!=null)m.data=this.getContextData(y.context);else if(y.image!=null)m.data=this.getImageData(y.image);else throw new Error("Invalid frame");return m},w.prototype.log=function(){var y;if(y=1<=arguments.length?l.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,y)},w}(a),s.exports=h},{"./browser.coffee":2,events:1}]},{},[3])(3)})});var xt=j((De,Gt)=>{var Ae=Bt(),Le=(it(),ht(et)).default,Z=new Le("Renderer.js");function Pt(t,e){if(!new.target)return new Pt(...arguments);let i=t.pixels.toArray(),r=i.length,s=new Proxy(t,{get:function(c,a,h){if(typeof a=="string"&&!isNaN(a)){let g=+a;if(Number.isInteger(g)&&g>=0&&g<r)return i[g]}else return Reflect.get(c,a,h)},set:function(c,a,h,g){if(typeof a=="string"&&!isNaN(a)){let v=Math.round(+a);Number.isInteger(v)&&v>=0&&v<r?i[v]=Array.isArray(h)?e.color(...h):h:Z.noop(`index ${v} out of range, ${r}`)}else return Reflect.set(c,a,h,g)}});return t.loaded=!0,Object.defineProperties(s,{blit:{value:function(c,a){t.pixels.set(i),e.image(t,c,a)}},length:{value:i.length},update:{value:function(){t.pixels.set(i)}}}),s}function Ct(t){if(!new.target)return new Ct(...arguments);let e=0,i=[];Object.defineProperties(i,{flip:{value:function(){e^=1}},read:{get:function(){return this[e^1]}},write:{get:function(){return this[e]}}});let r=t.createImage();i.push({buffer:r,get pixels(){return r.pixels.toArray()}});let s=t.createImage();i.push({buffer:s,get pixels(){return s.pixels.toArray()}}),Object.defineProperties(this,{flip:{value:function(){let c=i.write.buffer;c.update(),t.background(c),i.flip()}},readBuffer:{get:function(){return i.read.pixels}},writeBuffer:{get:function(){return i.write.buffer}}})}function dt(t){if(dt.instance!==void 0)return dt.instance;if(!new.target)return new dt(...arguments);Object.defineProperty(dt,"instance",{value:this});let e={background:4278849802,frameRate:60,height:t.height,showFrameRate:!1,showRuler:!1,width:t.width},i,r=!1,s=!1,c=50,a=new Ae({workers:navigator.hardwareConcurrency-2,quality:10}),h=!1,g=12,v=5,f=[];Object.defineProperties(this,{createImage:{value:function(o,l){let d=i.createImage(o??t.width,l??t.height);return new Pt(d,i)}},frame:{set:function(o){let l=i.width/2,d=i.height/2,u=new Proxy(o,{apply:function(p,w,y){if(p.apply(w,y),r&&(i.fill(255),i.textSize(12),i.text(i.__frameRate,i.width-50,i.height-10)),s){i.stroke(255),i.line(0,d,i.width,d),i.line(l,0,l,i.height);for(let x=c;x<i.width;x+=c)i.point(l+x,d-1),i.point(l-x,d-1),i.point(l+x,d+1),i.point(l-x,d+1);for(let x=c;x<i.height;x+=c)i.point(l-1,d+x),i.point(l-1,d-x),i.point(l+1,d+x),i.point(l+1,d-x)}if(h&&a.addFrame(t,{copy:!0,delay:1e3/i.frameRate()}),f.length>0){i.fill(255),i.textSize(g);for(let x=0;x<f.length;++x)i.text(f[x],i.width-200,i.height-300+x*g);f.length=0}}});Object.defineProperty(i,"draw",{value:u,writable:!0}),Z.debug("pjs.draw set")}},doubleBuffer:{value:function(){return new Ct(this)}},echo:{value:function(o){f.push(o),f.length>v&&f.shift()}},init:{value:function(o){if(i!==void 0){i.exit(),i=void 0;let u=document.createElement("canvas");t.replaceWith(u),t=u}let l=Object.assign({},e,o),d=this.echo.bind(this);i=new Processing(t,u=>{Z.info("Processing.js created"),Z.debug(`canvas width (${t.width}) height (${t.height})`),Object.defineProperties(u,{keyPressed:{value:function p(){switch(console.log(u.I,u.V),u.keyCode){case u.UP:u.loop();break;case u.DOWN:u.noLoop();break;case u.LEFT:switch(p.mode){case u.I:u.save("image.png");break;case u.v:h&&a.on("finished",function(w){window.open(URL.createObjectURL(w))}),h=!h;break}break;case u.RIGHT:u.redraw();break;case u.i:p.mode=u.I,d("Image capture mode");break;case u.V:p.mode=u.V,d("Video capture mode");break}},writable:!0},setup:{value:function(){u.size(l.width,l.height,u[l.renderer]),Z.debug(`processingjs width (${u.width}) height (${u.height}) ${u.use3DContext}`),u.frameRate(l.frameRate),u.noLoop(),u.background(l.background),r=l.showFrameRate,s=l.showRuler,Z.info("Processing.js setup")},writable:!0}})}),Object.setPrototypeOf(this,i)}},input:{set:function(o){Z.debug("keyPressed set"),Object.defineProperty(i,"keyPressed",{value:o,writable:!0})}},pixelHeight:{get:function(){return 0}},pixelWidth:{get:function(){return 0}}}),this.init()}Gt.exports={DoubleBuffer:Ct,Image:Pt,Renderer:dt}});var jt=j((qe,Vt)=>{function nt(){if(nt.instance instanceof nt)return nt.instance;if(!new.target)return new nt(...arguments);Object.defineProperty(nt,"instance",{value:this});let t=Math.PI/180;Object.defineProperties(this,{cos:{value:{},enumerable:!0},sin:{value:{},enumerable:!0}});for(let e=0;e<=360;++e)Object.defineProperty(this.cos,e,{value:Math.cos(e*t)}),Object.defineProperty(this.sin,e,{value:Math.sin(e*t)})}var ut=Object.freeze({addColors:(...t)=>t.length===0?[]:t[0].map((e,i)=>t.reduce((r,s)=>r+s[i],0)),decodeColor:t=>[t>>16&255,t>>8&255,t&255,t>>>24],direction:(t,e,i,r)=>Math.atan2(r-e,i-t),distance:(t,e,i,r)=>Math.hypot(Math.abs(i-t),Math.abs(r-e)),fastInvSqrt:t=>{let i=new Float32Array([t]),r=new Float32Array([t]),s=new Int32Array(i.buffer);return s[0]=1597463007-(s[0]>>1),r[0]=i[0],r[0]=r[0]*(1.5-t*.5*r[0]*r[0]),r[0]},fastTrig:nt(),invSqrt:t=>1/Math.sqrt(t),randomColor:(t=!1)=>{let e=Array.from({length:3},()=>ut.roll(255));return e.push(t?ut.roll(255):255),e},randomGrayscale:(t=!1)=>{let e=ut.roll(255),i=Array.from({length:3},()=>e);return i.push(t?ut.roll(255):255),i},range:(t,e)=>{let i=Math.random()*(e-t);return Number.isInteger(t)&&Number.isInteger(e)&&(i=Math.floor(i)),i+t},roll:t=>Math.floor(Math.random()*t)});Vt.exports=ut});var Jt=j((Xe,Kt)=>{function Pe(){this.x+=this.dx,this.y+=this.dy}function Ce(t){t.stroke(this.r,this.g,this.b,this.a),t.point(this.x,this.y)}function zt(t,e=Pe,i=Ce){if(!new.target)return new zt(...arguments);let r=2,s=new c;s.next=new c,s.prev=s.next,s.prev.next=s,s.prev.prev=s,s.active=!1,s.prev.active=!1,this.ACCELERATION=[0,.25],this.ELASTICITY=.2,this.MAX_COUNT=1e4,Object.defineProperties(this,{count:{get:function(){return r}},createParticle:{value:function(a,h,g,v,f,o,l,d,u){let p;if(s.prev.active){if(r>=this.MAX_COUNT)return;p=new c(a,h,g,v,f,o,l,d,u),p.next=s,p.prev=s.prev,p.prev.next=p,s.prev=p,s=p,++r}else p=s.prev,p.activate(a,h,g,v,f,o,l,d,u),s=p;return p}},list:{get:function(){return s}},render:{value:function(){let a=s;for(;a.active;){e.call(a,this),i.call(a,t);let h=a;if(a.ttl>0&&++a.t>=a.ttl&&(a.active=!1),a=a.next,a===s)break;h.active||(h===s?s=h.next:(h.next.prev=h.prev,h.prev.next=h.next,h.next=s,h.prev=s.prev,s.prev.next=h,s.prev=h))}}}});function c(a,h,g,v,f,o,l,d,u){if(!new.target)return new c(...arguments);Object.defineProperties(this,{activate:{value:function(p,w,y,x,m,b,E,L,A){this.active=!0,this.ttl=p,this.t=0,this.x=w,this.y=y,this.dx=x,this.dy=m,this.ddx=0,this.ddy=0,this.r=b,this.g=E,this.b=L,this.a=A}}}),this.activate(a,h,g,v,f,o,l,d,u)}}Kt.exports=zt});var te=j((We,Qt)=>{function Zt(t=10){if(!new.target)return new Zt(...arguments);let e=new Map;Object.defineProperties(this,{add:{value:function(i,r,s){let c=`${Math.floor(i/t)},${Math.floor(r/t)}`;if(e.has(c)){let a=e.get(c);a.includes(s)||a.push(s)}else e.set(c,[s])}},get:{value:function(i,r){let s=`${Math.floor(i/t)},${Math.floor(r/t)}`;return e.get(s)??[]}},remove:{value:function(i,r,s){let c=`${Math.floor(i/t)},${Math.floor(r/t)}`,a=e.get(c);if(a!==void 0){let h=a.indexOf(s);h!==-1&&a.splice(h,1)}}}})}Qt.exports={Space:Zt}});var se=j((Ye,ne)=>{var M=jt(),$=Jt(),n=xt().Renderer(),{Space:Re}=te();function ee(t,e,i,r){let s=r%t,c=Math.floor(r/t),a=i,h=Math.floor(s/e)%2==0,g=Math.floor(c/e)%2==0;return h!=g&&(a=0),[a,a,a,255]}function ie(t,e,i){let r=t.createShader(i);return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error("Shader compilation failed:",t.getShaderInfoLog(r)),null)}var Oe={"3d":function(){n.init({renderer:"P3D"});let t=n.width,e=n.height,i=0,r=255,s=255,c=255;n.frame=function(){n.background(0),n.camera(t/2,e/5,200,t/2,e/2,0,0,1,0),n.pointLight(r,s/10,c/10,t/3,e/3,100),n.pointLight(r/10,s,c/10,300,t/3,100),n.pointLight(r/10,s/10,c,300,300,-100),n.pointLight(r,s,c,t/3,300,-100),n.translate(t/2,e/2),n.rotateY(i),n.normal(0,0,1),n.fill(128),n.rect(-100,-100,200,200),i+=.01},n.loop()},ants:function(){let t=n.width,e=n.height,i=200,r=1,s=n.createImage();s.update();let c=new $(n,function(a){let h=a.list,g=h;for(;g.active;){if(g===this){if(g=g.next,g===h)break;continue}if(g=g.next,g===h)break}this.last??=M.roll(60),this.last++>60&&(this.ddx=M.range(-.05,.05),this.ddy=M.range(-.05,.05),this.last=0),this.dx+=this.ddx,this.dy+=this.ddy;let v=Math.hypot(this.dx,this.dy);v>r&&(this.dx=this.dx/v*r,this.dy=this.dy/v*r);let f=this.x-3*this.dx,o=this.y-3*this.dy;this.x+=this.dx,this.y+=this.dy,n.line(this.x,this.y,f,o),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-1?(this.y=e-1,this.dy*=-1):this.y<0&&(this.y=0,this.dy*=-1)});for(let a=0;a<i;++a)c.createParticle(0,M.range(1e-4,t),M.range(1e-4,e),0,0,207,16,32);n.stroke(0,0,0,255),n.frame=function(){n.background(s),c.render()},n.loop()},balls:function(){n.init({showFrameRate:!0});let t=n.width,e=n.height,i=1e3,r=10,s=2,c=new Re(r*3),a=new $(n,function(){this.x+=this.dx,this.y+=this.dy,this.x<0&&(this.x=0,this.dx*=-1),this.x>t&&(this.x=t,this.dx*=-1),this.y<0&&(this.y=0,this.dy*=-1),this.y>e&&(this.y=e,this.dy*=-1);let h=c.get(this.x,this.y);for(let v=0;v<h.length;++v){let f=h[v];if(f===this)continue;let o=Math.hypot(this.x-f.x,this.y-f.y);if(o<r){let l=Math.atan2(this.y-f.y,this.x-f.x),d=(r-o)/r;this.dx+=Math.cos(l)*d,this.dy+=Math.sin(l)*d,f.dx-=Math.cos(l)*d,f.dy-=Math.sin(l)*d,this.x+=this.dx,this.y+=this.dy,f.x+=f.dx,f.y+=f.dy}}c.add(this.x,this.y,this);let g=Math.hypot(this.dx,this.dy);g>s&&(this.dx=this.dx/g*s,this.dy=this.dy/g*s)},function(h){h.fill(this.r,this.g,this.b,this.a),h.stroke(this.r,this.g,this.b,this.a),h.ellipse(this.x,this.y,r,r)});for(let h=0;h<i;++h){let g=a.createParticle(0,M.range(.01,t),M.range(.01,e),M.range(-1,1.01),M.range(-1,1.01),...M.randomColor());c.add(g.x,g.y,g)}n.frame=function(){n.background(0),a.render()},n.loop()},blackhole:function(){n.init({});let t=n.width,e=n.height,i=t/2,r=e/2,s=25,c=200,a=new $(n,function(h){});for(let h=0;h<c;++h);n.frame=function(){n.background(0),n.stroke(255),n.fill(0),n.ellipse(i,r,s,s),a.render()},n.loop()},boids:function(){let t=n.width,e=n.height,i=t/2,r=e/2,s=200,c=3,a=5e-4,h=100,g=40,v=1,f=1.25,o=1,l=.75,d=new $(n,function(p){let w=0,y=0,x=0,m=0,b=0,E=0,L=0,A=0,C=0,R=0,P=p.list,O=P;for(;O.active;){if(O===this){if(O=O.next,O===P)break;continue}let I=Math.hypot(this.x-O.x,this.y-O.y);if(I<h&&(w+=O.dx,y+=O.dy,x+=O.x,m+=O.y,C++),I<g){let T=(g-I)/g;b+=(this.x-O.x)*T,E+=(this.y-O.y)*T,R++}if(O=O.next,O===P)break}if(C>0){w/=C,y/=C;let I=Math.hypot(w,y);I>0&&(w=w/I*a*v,y=y/I*a*v),x=(x/C-this.x)*a*f,m=(m/C-this.y)*a*f}if(R>0){b/=R,E/=R;let I=Math.hypot(b,E);I>0&&(b=b/I*a*o,E=E/I*a*o)}if(Math.random()>l){let I=Math.atan2(this.dy,this.dx)+M.range(-.1,.1),T=Math.hypot(this.dx,this.dy);L=T*Math.cos(I)-this.dx,A=T*Math.sin(I)-this.dy}this.ddx=w+x+b+L,this.ddy=y+m+E+A,this.dx+=this.ddx,this.dy+=this.ddy;let S=Math.hypot(this.dx,this.dy);S>c&&(this.dx=this.dx/S*c,this.dy=this.dy/S*c);let F=this.x-3*this.dx,D=this.y-3*this.dy;this.x+=this.dx,this.y+=this.dy,n.line(this.x,this.y,F,D),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-1?(this.y=e-1,this.dy*=-1):this.y<0&&(this.y=0,this.dy*=-1)}),u=M.range(0,2*Math.PI);for(let p=0;p<s;++p){let w=M.range(.001,1)*c,y=M.range(-.1,.1);d.createParticle(0,M.range(i-10.01,i+10),M.range(r-10.01,r+10),w*Math.cos(y+u),w*Math.sin(y+u),...M.randomColor())}n.stroke(0,0,0,255),n.frame=function(){n.background(0),d.render()},n.loop()},bz:function(){let t=n.width,e=Array.from({length:8},()=>Math.random()*t),i=Array.from({length:8},()=>Math.random()*t),r=Array.from({length:8},()=>Math.random()*15);n.background(255),n.noFill(),n.frame=function(){n.stroke(0,0,0,20),e.map(function(s,c,a){let h=s+r[c];h<0?(h=0,r[c]*=-1):h>t&&(h=t,r[c]*=-1),a[c]=h}),n.bezier.apply(null,e),n.stroke(255,128,128,20),i.map(function(s,c,a){let h=s+r[c];h<0?(h=0,r[c]*=-1):h>t&&(h=t,r[c]*=-1),a[c]=h}),n.bezier.apply(null,i)},n.loop()},cell:function(t=30,e=!1,i=200,r=200){n.init({background:0,frameRate:400,height:+r,width:+i});let s=n.width,c=n.height,a=1,h=0,g=new Array(s*c).fill(h),v=(l=>{let d=l.toString(2).padStart(8,"0"),u=[];for(let p=0;p<8;++p)+d[7-p]&&u.push(p);return(p,w)=>{let y=(w-1)*s+p,x=parseInt([g[y-1],g[y],g[y+1]].join(""),2);return u.some(m=>x===m)?a:h}})(+t);if(n.stroke(255),e===!1||e==="false")g[s/2]=a,n.point(s/2,0);else if(e==="random")for(let l=0;l<s;++l)Math.random()>.5&&(g[l]=a,n.point(l,0));else{let l=e.length,d=Math.floor((s-l)/2);for(let u=0;u<l;++u)+e[u]&&(g[d+u]=a,n.point(d+u,0))}let f=0,o=g.length/s;n.frame=function(){for(let l=0;l<s;++l){let d=v(l,f);d&&(g[f*s+l]=d,n.point(l,f))}f!==o&&f++},n.loop()},chaos:function(t="3",e,i){n.init({frameRate:400});let r=n.width,s=n.height,c=r/2,a=s/2,h=c-50,g=Math.PI/180,v=e==="alt"?{3:[{x:r/2,y:50},{x:50,y:s-50},{x:r-50,y:s-50}],4:[{x:r/2,y:50},{x:50,y:s-50},{x:r-50,y:s-50},{x:c,y:a}],5:[{x:r-50,y:50},{x:50,y:50},{x:50,y:s-50},{x:r-50,y:s-50},{x:c,y:a}],8:[{x:50,y:50},{x:r-50,y:50},{x:r-50,y:s-50},{x:50,y:s-50},{x:c,y:50},{x:r-50,y:a},{x:c,y:s-50},{x:50,y:a}]}[t]:(d=>{let u=[];for(let p=0;p<d;++p){let w=(p*(360/d)-90)*g;u.push({x:Math.cos(w)*h+c,y:Math.sin(w)*h+a})}return e==="center"&&u.push({x:c,y:a}),u})(+t),f=e==="alt"?{3:.5,4:.573,5:.666667,8:.666667}[t]:i??{0:1/(1+Math.tan(Math.PI/t)),1:1/(1+2*Math.sin(Math.PI/(2*t))),2:1/(1+Math.sin(Math.PI/t)),3:1/(1+2*Math.sin(Math.PI/(2*t)))}[+t%4];n.background(0),n.stroke(255,255,255,255);for(let{x:d,y:u}of v)n.point(d,u);let o=Math.random()*r,l=Math.random()*s;n.frame=function(){let d=M.roll(v.length);o+=(v[d].x-o)*f,l+=(v[d].y-l)*f,n.point(o,l)},n.loop()},fire:function(){n.init({background:0,frameRate:60,height:300,showFrameRate:!1,width:300});let t=n.width,e=n.doubleBuffer(),i=n.createImage(),r=n.color(255,128,96),s=4294940974;for(let g=0;g<i.length;++g)i[g]=419076398;i.update();let c=e.writeBuffer;for(let g=0;g<c.length;++g)c[g]=[0,0,0,255];e.flip(),c=e.writeBuffer;for(let g=0;g<c.length;++g)c[g]=[0,0,0,255];e.flip();let a=e.readBuffer.length/t,h=new $(n,function(){this.x+=this.dx,this.y+=this.dy,this.dy-=.05,this.x<1&&(this.x=1,this.dx*=-.5),this.x>=t-2&&(this.x=t-2,this.dx*=-.5),(this.y|0)<4&&(this.active=!1)},function(g){e.writeBuffer[(this.y|0)*t+this.x]=g.color(this.r,this.g,this.b,this.a*(1-this.t/this.ttl))});n.frame=function(){let g=e.readBuffer,v=e.writeBuffer;for(let f=0;f<t;++f)Math.random()>.97&&h.createParticle(M.range(12,24)*4,f,a-1,M.range(-.95,.95),-M.range(.01,.0625),s);for(let f=t;f<v.length-t;++f){if(f%t<1||f%t>=t-1)continue;let o=f/t;if(Math.random()<Math.pow(Math.E,Math.pow(o/a,10))-1&&Math.random()>.995){v[f-1]=r,v[f+1]=r,h.createParticle(M.range(12,24)*2,f%t,f/t,M.range(-.3,.3),-M.range(.01,.0625),r);continue}v[f]=M.addColors(M.decodeColor(g[f-1]),M.decodeColor(g[f]),M.decodeColor(g[f]),M.decodeColor(g[f+1]),M.decodeColor(g[f+t])).map((l,d)=>{if(d===3)return 255;let u=l/5.3;return u<10?0:u})}h.render(),e.flip(),i.blit(0,0)},n.loop()},fireworks:function(t=1){let e=n.width,i=n.height;t=+t;let r=t===0?function(o){o.stroke(this.r,this.g,this.b,this.a),o.point(this.x,this.y)}:function(o){o.fill(this.r,this.g,this.b,this.a),o.ellipse(this.x,this.y,t*this.ttl/this.t,t*this.ttl/this.t)},s=new $(n,function(){this.dx+=s.ACCELERATION[0],this.dy+=s.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let o=1-this.t/this.ttl;this.r=255*Math.pow(o,.2),this.g=255*o*o,this.b=255*o*o*o*o,this.a=255*o},r),c=new $(n,function(){this.dx+=c.ACCELERATION[0],this.dy+=c.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let o=1-this.t/this.ttl;this.b=255*Math.pow(o,.2),this.g=255*o*o,this.r=255*o*o*o*o,this.a=255*o},r),a=new $(n,function(){this.dx+=a.ACCELERATION[0],this.dy+=a.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let o=1-this.t/this.ttl;this.g=255*Math.pow(o,.2),this.r=255*o*o,this.b=255*o*o*o*o,this.a=255*o},r),h=new $(n,function(){this.dx+=h.ACCELERATION[0],this.dy+=h.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let o=1-this.t/this.ttl;this.r=255*Math.pow(o,.2),this.g=255*Math.pow(o,.2),this.b=255*o*o*o*o,this.a=255*o},r),g=new $(n,function(){this.dx+=g.ACCELERATION[0],this.dy+=g.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let o=1-this.t/this.ttl;this.r=255*Math.pow(o,.2),this.b=255*o*o*o*o,this.g=255*o,this.a=255*o},r),v=new $(n,function(){this.dx+=v.ACCELERATION[0],this.dy+=v.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let o=1-this.t/this.ttl;this.r=255*Math.pow(o,.2),this.b=255*Math.pow(o,.2),this.g=255*o*o*o*o,this.a=255*o},r);s.ACCELERATION=[0,.15],c.ACCELERATION=[0,.15],a.ACCELERATION=[0,.15],h.ACCELERATION=[0,.15],g.ACCELERATION=[0,.15],v.ACCELERATION=[0,.15];function f(o,l){let d;switch(M.range(0,5)){case 0:d=s;break;case 1:d=c;break;case 2:d=a;break;case 3:d=h;break;case 4:d=v;break;case 5:d=g;break}for(let u=0;u<300;++u){let p=M.range(0,Math.PI*2),w=M.range(.001,10);d.createParticle(M.range(50.001,100),o,l,Math.cos(p)*w,Math.sin(p)*w,0,0,0,0)}}n.frame=function(){n.background(0),Math.random()>.95&&f(M.range(.001,e),M.range(.001,i/2)),s.render(),c.render(),a.render(),h.render(),v.render(),g.render()},n.loop()},fountain:function(){let t=n.width,e=n.height,i=new $(n,function(){this.dx+=i.ACCELERATION[0],this.dy+=i.ACCELERATION[1],this.x+=this.dx,this.y+=this.dy;let c=1-this.t/this.ttl;this.r=255*Math.pow(c,.2),this.g=255*c*c,this.b=255*c*c*c*c,this.a=255*Math.pow(c,.2),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-2?(this.dy<.25?this.y=e-1:this.y=e-2,this.dy*=-1.2*Math.random()*i.ELASTICITY,Math.random()<.5?this.dx-=this.dy:this.dx+=this.dy):this.y<0&&(this.y=0,this.dy*=-1*i.ELASTICITY),this.y===e-1&&(this.active=!1)}),r=-20.01,s=[255,255,255,255];n.frame=function(){n.background(0);for(let c=0;c<15;++c){let a=M.range(-.098,.098),h=M.range(r,.8*r);i.createParticle(M.range(10,30.01)*-h,t/2,e-20,Math.sin(a)*h,Math.cos(a)*h,...s)}i.render()},n.loop()},graviton:function(t=20,e=66743e-15){let i=n.width,r=n.height,s=i/2,c=r/2,a=25,h=+t,g=6,v=2,f=+e,o=1e7,l=1e6,d=1.0312,u=new $(n,function(p){let w=0,y=0,x=p.list,m=x;for(;m.active;){if(m===this){if(m=m.next,m===x)break;continue}let P=M.distance(this.x,this.y,m.x,m.y),O=M.direction(this.x,this.y,m.x,m.y),S=f*l*l/(P/d)**v,F=S*Math.cos(O),D=S*Math.sin(O);if(P<1){let I=M.direction(this.x,this.y,m.x,m.y),T=Math.cos(I),z=Math.sin(I),N=Math.hypot(this.dx,this.dy),H=Math.hypot(m.dx,m.dy);this.dx=H*T,this.dy=H*z,m.dx=N*T,m.dy=N*z;break}else P<3?(w+=-F*2,y+=-D*2):(w+=F,y+=D);if(m=m.next,m===x)break}this.ddx=w,this.ddy=y;let b=M.direction(this.x,this.y,s,c),E=M.distance(this.x,this.y,s,c),L=f*o*l/(E/d)**v,A=L*Math.cos(b),C=L*Math.sin(b);E<a?(this.ddx+=-C*2,this.ddy+=-A*2):(this.ddx+=A,this.ddy+=C),this.dx+=this.ddx,this.dy+=this.ddy;let R=Math.hypot(this.dx,this.dy);R>g&&(this.dx=this.dx/R*g,this.dy=this.dy/R*g),this.x+=this.dx,this.y+=this.dy,this.x>=i-1?(this.x=i-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=r-1?(this.y=r-1,this.dy*=-1):this.y<0&&(this.y=0,this.dy*=-1)},function(p){p.stroke(this.r,this.g,this.b,this.a),p.ellipse(this.x,this.y,3,3)});for(let p=0;p<h;++p){let w=g,y=1.25+M.range(-.088,.088);u.createParticle(0,M.roll(s-100),M.roll(c),w*Math.cos(y),w*Math.sin(y),255,255,196)}n.stroke(0,0,0,255),n.frame=function(){n.background(0),u.render(),n.fill(255,255,200),n.stroke(255,255,0),n.ellipse(s,c,a,a)},n.loop()},lens:function(t=150,e=30){t=+t,e=+e;let i=n.width,r=n.createImage(),s=r.height;for(let p=0;p<r.length;++p)r[p]=ee(s,s/32,255,p);r.update();let c=n.createImage(t,t),a=new Array(t*t).fill(0),h=Math.round(t/2),g=h*h,v=h*(t+1),f;for(let p=0;p<g;++p){let w=p%h,y=Math.floor(p/h),x=w*w,m=y*y,b=0,E=0;if(x+m<g){let L=e/Math.sqrt(e*e-(x+m-g));b=Math.floor(w*L)-w,E=Math.floor(y*L)-y}f=E*i+b,a[v-y*t-w]=-f,a[v+y*t+w]=f,f=-E*i+b,a[v-y*t+w]=f,a[v+y*t-w]=-f}let o=i/2,l=i/2,d=1,u=2;n.frame=function(){o+=d,l+=u,o<0&&(o=0,d=-d),o>i-t&&(o=i-t,d=-d),l<0&&(l=0,u=-u),l>i-t&&(l=i-t,u=-u),n.background(r);let p=l*i+o;for(let w=0;w<t*t;++w)c[w]=r[Math.round(p)+Math.floor(w/t)*i+w%t+a[w]];c.blit(o,l)},n.loop()},life:function(t=300,e=300){n.init({background:0,frameRate:12,height:+e,width:+t});let i=n.width,r=n.height,s=.05,c=0,a=1,h=1,g=0,v=-1,f=Array.from(Array(i*r)).map(()=>Array.from(Array(2)));f.forEach(l=>{l[c]=g,l[a]=Math.random()<s?h:g});function o(l){let d=l%i,u=Math.floor(l/i),p=0;return u>0&&(d>0&&(p+=f[l-i-1][c]),d<i-1&&(p+=f[l-i+1][c]),p+=f[l-i][c]),u<r-1&&(d>0&&(p+=f[l+i-1][c]),d<i-1&&(p+=f[l+i+1][c]),p+=f[l+i][c]),d>0&&(p+=f[l-1][c]),d<i-1&&(p+=f[l+1][c]),p}n.stroke(255),n.frame=function(){n.background(0),f.forEach((l,d)=>{let u=f[d];if(l[a]===h||l[c]===h){u[c]=h;let x=d%i,m=d/i;n.point(x,m)}l[a]===v&&(u[c]=g),u[a]=g;let p=d-3*i;if(p<0)return;let w=f[p],y=o(p);y===3&&w[c]===g&&(w[a]=h),(y<2||y>3)&&w[c]===h&&(w[a]=v)})},n.loop()},orbit:function(t,e="off",i=66743e-15){n.init({showRuler:e==="full"});let r=n.width,s=n.height,c=r/2,a=s/2,h=n.PVector.bind(n),g=25,v=2,f=+i*1,o=1e13*2,l=1,d=2,u=s/4,p=Math.sqrt(f*o*l/u),w=.05,y=new $(n,function(){let x=new h(c,a),m=new h(this.x,this.y);m.sub(x);let b=new h(this.dx,this.dy),E=M.direction(0,0,b.x,b.y),L=b.mag(),A=new h(m.y,-m.x);A.normalize();let C=Math.sign(b.x*m.y-b.y*m.x);A.mult(C);let R=M.direction(this.x,this.y,c,a),P=m.mag(),O=f*o*l/(P/d)**v,S=new h(Math.cos(R),Math.sin(R)),F=-f*o*l/P,D=.5*l*L**2,I=D+F,T=b.dot(m)/P,z=Math.sqrt(L**2-T**2),N=[],H="";if(this.thrustX=0,this.thrustY=0,t!=="off"){let q=new h(m.x,m.y);q.normalize();let G=new h(q.y,-q.x);if(I>=0)if(N.push("ub"),p=Math.sqrt(f*o*l/P),q.mult(p),G.mult(p),L>p){let V=Math.abs(T)>q.mag(),X=Math.abs(z)>G.mag();V?T>0?(N.push("hra"),P<u&&!X?(H+=`
increase tangential velocity`,this.thrustX+=A.x,this.thrustY+=A.y):(H+=`
reduce radial velocity`,this.thrustX+=S.x,this.thrustY+=S.y)):(N.push("hrd"),P<u?(H+=`
increase radial velocity`,this.thrustX+=-S.x,this.thrustY+=-S.y):X||(H+=`
increase tangential velocity`,this.thrustX+=A.x,this.thrustY+=A.y)):T>0?(N.push("sra"),H+=`
increase radial velocity`,this.thrustX+=-S.x,this.thrustY+=-S.y):(N.push("srd"),H+=`
increase radial velocity`,this.thrustX+=-S.x,this.thrustY+=-S.y),X?(N.push("ft"),H+=`
reduce tangential velocity`,this.thrustX+=-A.x,this.thrustY+=-A.y):(N.push("st"),H+=`
increase tangential velocity`,this.thrustX+=A.x,this.thrustY+=A.y)}else P>u?N.push("ha"):N.push("la");else N.push("b"),p=Math.sqrt(2*f*o*l/P),q.mult(p),G.mult(p),L<p?(z<G.mag()&&(N.push("s"),P>u&&N.push("ha"),H+=`
increasing tangential velocity`,this.thrustX+=A.x,this.thrustY+=A.y),Math.abs(T)>q.mag()&&N.push("fr"),Math.abs(T)<q.mag()&&N.push("sr")):L>p&&N.push("?");let ft=2*Math.atan(g/P),gt=Math.PI/8,Q=(R-E+Math.PI)%(2*Math.PI)-Math.PI;if(Math.abs(Q)<ft){N.push("c");let V=R+Math.sign(-Q)*(Math.PI/2+gt);H+=`
alter course (${E.toFixed(2)} -> ${V.toFixed(2)})`;let X=new h(Math.cos(V),Math.sin(V));this.thrustX+=X.x,this.thrustY+=X.y,e==="full"&&(X.setMag(w),n.stroke(255,128,64,255),n.line(this.x,this.y,this.x+X.x,this.y+X.y))}let tt=.5*l*p**2-f*o*l/u,st=Math.abs(I-tt)/Math.abs(tt),rt=Math.abs(T)/Math.max(Math.abs(q.mag()),1e-6),pt=Math.abs(z-G.mag())/Math.max(G.mag(),1e-6),yt=Math.min(1,Math.max(.1,1-.5*(st+rt+pt))),K=new h(this.thrustX,this.thrustY);K.normalize(),K.mult(w*yt),this.thrustX=K.x,this.thrustY=K.y}if(S.mult(O),this.ddx=S.x+this.thrustX,this.ddy=S.y+this.thrustY,this.dx+=this.ddx,this.dy+=this.ddy,this.x+=this.dx,this.y+=this.dy,this.x>=r-1?(this.x=r-1,this.dx=0):this.x<0&&(this.x=0,this.dx=0),this.y>=s-1?(this.y=s-1,this.dy=0):this.y<0&&(this.y=0,this.dy=0),e==="full"){let q=`x: ${this.x}
y: ${this.y}
dx: ${this.dx}
dy: ${this.dy}
ddx: ${this.ddx}
ddy: ${this.ddy}
E: ${I}
E_p: ${F}
E_k: ${D}
v_t: ${z}
v_r: ${T}
v: ${L}
vTarg: ${p}
dist: ${P}
thrustX: ${this.thrustX}
thrustY: ${this.thrustY}
status: ${N.join(", ")??"pending"}
action: ${H??""}`;n.text(q,20,n.height-300),n.stroke(128,128,255,255),n.line(this.x,this.y,this.x+A.x*50,this.y+A.y*50)}},function(x){if(x.fill(this.r,this.g,this.b,this.a),x.stroke(this.r,this.g,this.b,this.a),x.ellipse(this.x,this.y,3,3),e==="full"){x.line(c,a,this.x,this.y);let m=new h(this.dx,this.dy);m.mult(10);let b=new h(this.thrustX,this.thrustY);b.mult(1e3),x.stroke(0,255,0,255),x.line(this.x,this.y,this.x+m.x,this.y+m.y),x.stroke(255,0,0,255),x.line(this.x,this.y,this.x+b.x,this.y+b.y)}});y.createParticle(0,M.roll(r),M.roll(s),1,1,255,255,255,255),n.frame=function(){e!=="on"&&n.background(0),y.render(),n.fill(255,255,200),n.stroke(255,255,0),n.ellipse(c,a,g,g)},n.background(0),n.loop()},pattern:function(t){let e=n.createImage(),i=e.height;for(let v=0;v<e.length;++v)e[v]=ee(i,i/8,255,v);if(e.update(),n.background(e),t===void 0)return;n.init({showFrameRate:!0,showRuler:!0});let r=n.PVector.bind(n),s=20,c=360,a=n.width/2,h=n.height/2,g=Math.hypot(100,100);n.frame=()=>{n.background(0);let v=Math.PI/c*n.frameCount,f=Math.cos(v),o=Math.sin(v),l=Math.PI/s*n.frameCount,d=Math.cos(l),u=Math.sin(l),p=-u,w=d,y=new r(a,h),x=new r(f,o);x.setMag(g),x.add(y);let m=new r(f,o),b=new r(f,o);m.setMag(g*.33),b.setMag(g*.66);let E=new r(p,w);E.setMag(m.mag()*.5),E.add(m),E.add(y);let L=new r(d,u);L.setMag(b.mag()*.5),L.add(b),L.add(y);let A=new r(x.x,x.y);A.sub(y);let C=new r(E.x,E.y);C.sub(y);let R=(A.x*C.y-A.y*C.x)/A.mag()*1.5,P=new r(y.x,y.y);P.sub(x);let O=new r(-P.y,P.x);switch(O.setMag(R),O.add(x),n.fill(0,0,0,0),t){case"circles":case"full":if(n.stroke(255,0,0,255),n.line(y.x,y.y,x.x,x.y),n.ellipse(y.x+m.x,y.y+m.y,m.mag(),m.mag()),n.ellipse(y.x+b.x,y.y+b.y,b.mag(),b.mag()),n.stroke(0,255,0,255),n.line(y.x+m.x,y.y+m.y,E.x,E.y),n.line(y.x+b.x,y.y+b.y,L.x,L.y),n.line(x.x,x.y,O.x,O.y),n.ellipse(E.x,E.y,3,3),n.ellipse(L.x,L.y,3,3),n.ellipse(O.x,O.y,3,3),t==="circles")break;case"tail":n.stroke(255,255,255,255),n.bezier(y.x,y.y,E.x,E.y,L.x,L.y,O.x,O.y)}},n.loop()},plasma:function(){n.init({background:0,height:300,width:300});let t=n.width,e=n.height,i=n.createImage(),r={},s={};function c(u){let p=1-u/255,w=255*p,y=255*p*p;return[255*p*p*p*p,y,w,255]}for(let u=0;u<256;++u)s[u]=c(u);for(let u=0;u<512;++u){let p=u*.703125*.0174532;r[u]=Math.sin(p)*1024}let a=0,h=0,g=0,v=0,f=0,o=0,l=0,d=0;n.frame=function(){l=g,d=v;for(let u=0;u<e;++u){f=a+5,o=h+3,l&=511,d&=511;for(let p=0;p<t;++p){f&=511,o&=511;let y=128+(r[f]+r[o]+r[l]+r[d]>>4);i[u*t+p]=s[y],f+=5,o+=3}l+=1,d+=3}a+=9,g+=8,i.update(),n.background(i)},n.loop()},rod:function(){let t=n.width,e=n.height,i=t/2,r=e/2,s=t/2+M.range(-100,100.01),c=t/2+M.range(-100,100.01),a=M.roll(-3.01,3),h=M.roll(-3.01,3),g,v,f=20,o=12,l=5,d=200,u=3,p=5e-4,w=100,y=40,x=.75,m=.5,b=3,E=.66,L=new $(n,function(C){let R={x:0,y:0},P={x:0,y:0},O={x:0,y:0},S={x:0,y:0},F=0,D=0,I=C.list,T=I;for(;T.active;){if(T===this){if(T=T.next,T===I)break;continue}let W=Math.hypot(this.x-T.x,this.y-T.y);if(W<w&&(R.x+=T.dx,R.y+=T.dy,P.x+=T.x,P.y+=T.y,F++),W<y){let ot=(y-W)/y;O.x+=(this.x-T.x)*ot,O.y+=(this.y-T.y)*ot,D++}if(T=T.next,T===I)break}if(g+=this.x,v+=this.y,F>0){R.x/=F,R.y/=F;let W=Math.hypot(R.x,R.y);W>0&&(R.x=R.x/W*p*x,R.y=R.y/W*p*x),P.x=(P.x/F-this.x)*p*m,P.y=(P.y/F-this.y)*p*m}if(D>0){O.x/=D,O.y/=D;let W=Math.hypot(O.x,O.y);W>0&&(O.x=O.x/W*p*b,O.y=O.y/W*p*b)}if(Math.random()>E){let W=Math.atan2(this.dy,this.dx)+M.range(-.1,.1),ot=Math.hypot(this.dx,this.dy);S.x=ot*Math.cos(W)-this.dx,S.y=ot*Math.sin(W)-this.dy}this.ddx=R.x+P.x+O.x+S.x+(s-this.x)*1e-4,this.ddy=R.y+P.y+O.y+S.y+(c-this.y)*1e-4,M.distance(this.x,this.y,s,c)<50&&(this.ddx+=(s-this.x)*.01,this.ddy+=(c-this.y)*.01),this.dx+=this.ddx,this.dy+=this.ddy;let N=Math.hypot(this.dx,this.dy);N>u&&(this.dx=this.dx/N*u,this.dy=this.dy/N*u),this.x+=this.dx,this.y+=this.dy;let H=M.direction(this.x,this.y,this.x-this.dx,this.y-this.dy),q=Math.cos(H),G=Math.sin(H),ft=.33*o,gt=.66*o,Q=ft*q,tt=ft*G,st=gt*q,rt=gt*G,pt=this.x+o*q,yt=this.y+o*G;this.unique??=M.roll(Math.PI/2);let K=Math.PI/l*n.frameCount+this.unique,V=Math.cos(K),X=Math.sin(K),ae=this.x+Q+.5*(Q*-X-tt*V),he=this.y+tt+.5*(Q*V+tt*-X),ce=this.x+st+.5*(st*V-rt*X),le=this.y+rt+.5*(st*X+rt*V),It=this.x-pt,St=this.y-yt,_t=Math.hypot(It,St),de=-St/_t,ue=It/_t,Nt=X*3,fe=pt+de*Nt,ge=yt+ue*Nt;n.bezier(this.x,this.y,ae,he,ce,le,fe,ge),this.x>=t-1?(this.x=t-1,this.dx*=-1):this.x<0&&(this.x=0,this.dx*=-1),this.y>=e-1?(this.y=e-1,this.dy*=-1):this.y<0&&(this.y=0,this.dy*=-1)},function(C){C.stroke(this.r,this.g,this.b,this.a),C.ellipse(this.x,this.y,2,2)}),A=M.range(0,2*Math.PI);for(let C=0;C<d;++C){let R=M.range(.001,1)*u,P=M.range(-.1,.1);L.createParticle(0,M.range(i-10.01,i+10),M.range(r-10.01,r+10),R*Math.cos(P+A),R*Math.sin(P+A),255,255,255,255)}n.frame=function(){g=0,v=0,n.background(0),n.fill(0,0,0,0),n.stroke(255,255,255,255),L.render(),g/=L.count,v/=L.count,a+=-(g-s)*1e-4+(i-s)*1e-4,h+=-(v-c)*1e-4+(r-c)*1e-4;let C=Math.hypot(a,h);C>u*1.4&&(a=a/C*u*1.4,h=h/C*u*1.4),s+=a,c+=h,s<0&&(s=0,a=-a),s>t-f&&(s=t-f,a=-a),c<0&&(c=0,h=-h),c>e-f&&(c=e-f,h=-h),n.stroke(196,128,196),n.fill(255,128,164,128),n.ellipse(s,c,f,f)},n.loop()},shader:function(){n.init({showFrameRate:!0,renderer:"WEBGL"});let t=n.width,e=n.height,i=`
			attribute vec3 aPosition;
			void main(){
				gl_PointSize = 10.0;
				gl_Position = vec4(aPosition, 1.0);
			}
		`,r=`
			precision mediump float;
			void main(){
				gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0); // Green
			}
		`,s=n.externals.context;s.viewport(0,0,t,e),console.log("Canvas width:",s.canvas.width,"Height:",s.canvas.height),console.log("Viewport dimensions:",s.getParameter(s.VIEWPORT)),console.log("Max viewport dims:",s.getParameter(s.MAX_VIEWPORT_DIMS)),console.log("Supported extensions:",s.getSupportedExtensions()),console.log("Max vertex attribs:",s.getParameter(s.MAX_VERTEX_ATTRIBS)),console.log("Max texture size:",s.getParameter(s.MAX_TEXTURE_SIZE));let c=ie(s,i,s.VERTEX_SHADER),a=ie(s,r,s.FRAGMENT_SHADER),h=s.createProgram();s.attachShader(h,c),s.attachShader(h,a),s.linkProgram(h),s.getProgramParameter(h,s.LINK_STATUS)||console.error("Could not link shaders:",s.getProgramInfoLog(h)),s.useProgram(h);let g=new Float32Array([0,0,0]),v=s.createBuffer();s.bindBuffer(s.ARRAY_BUFFER,v),s.bufferData(s.ARRAY_BUFFER,g,s.STATIC_DRAW);let f=s.getBufferParameter(s.ARRAY_BUFFER,s.BUFFER_SIZE);console.log("Buffer size (bytes):",f);let o=s.getAttribLocation(h,"aPosition");if(s.enableVertexAttribArray(o),s.vertexAttribPointer(o,3,s.FLOAT,!1,0,0),o===-1){console.error("Attribute aPosition not found in shader");return}console.log("aPosition location: ",s.getAttribLocation(h,"aPosition")),s.disable(s.CULL_FACE),s.disable(s.DEPTH_TEST);let l=s.getError();l!==s.NO_ERROR&&console.error("WebGL error during setup:",l),n.frame=function(){s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),s.drawArrays(s.POINTS,0,1),s.flush();let d=s.getError();d!==s.NO_ERROR&&console.error("WebGL error during draw:",d)},n.loop()},snow:function(){let t=n.width,e=n.height,i=new $(n,function(){this.x+=this.dx,this.y+=this.dy,(this.x>=t-1||this.y>=e-1||this.y<0)&&(this.active=!1)});n.frame=function(){n.background(0),i.createParticle(0,M.range(-t/2,t-1),0,M.range(0,.25),M.range(.4,.6),255,255,255,M.range(96,255)),i.render()},n.loop()},spiro:function(t=!0,e=!1,i=!0){let r=n.width,s=n.height,c=n.PVector.bind(n),a=new c(r/2,s/2),h=new c(0,0),g=new c(0,0),v=i==="false"?360:36,f=r/2,o=100,l=M.roll(o),d=M.roll(f),u=Math.random(),p=Math.random(),w=(o+l)/l,y=(f-d)/d;n.frame=function(){let x=Math.PI/v*n.frameCount,m=Math.cos(x),b=Math.sin(x),E=Math.PI/v*n.frameCount*w,L=-Math.PI/v*n.frameCount*y,A=new c(m,b);A.setMag(f-d),A.add(a);let C=new c(m,b);C.setMag(o+l),C.add(a);let R=new c(Math.cos(E),Math.sin(E));R.setMag(l*u),R.add(C);let P=new c(Math.cos(L),Math.sin(L));P.setMag(d*p),P.add(A),i==="false"?(n.background(0),n.fill(0,0,0,0),n.stroke(0,255,0,255),n.ellipse(a.x,a.y,f*2,f*2),n.ellipse(a.x,a.y,o*2,o*2),t&&t!=="false"&&(n.stroke(255,255,255,255),n.line(a.x,a.y,A.x,A.y),n.line(A.x,A.y,P.x,P.y),n.stroke(255,0,0,255),n.ellipse(A.x,A.y,d*2,d*2),n.ellipse(P.x,P.y,2,2)),e&&e!=="false"&&(n.stroke(255,255,255,255),n.line(a.x,a.y,C.x,C.y),n.line(C.x,C.y,R.x,R.y),n.stroke(255,0,0,255),n.ellipse(C.x,C.y,l*2,l*2),n.ellipse(R.x,R.y,2,2))):(n.stroke(255,255,255,255),t&&t!=="false"&&(g.mag()===0&&g.set(P),n.line(g.x,g.y,P.x,P.y),g.set(P)),n.stroke(128,255,128,255),e&&e!=="false"&&(h.mag()===0&&h.set(R),n.line(h.x,h.y,R.x,R.y),h.set(R)))},n.loop()},stars:function(){let t=n.width,e=n.height,i=t/2,r=e/2,s=i*.75,c=new $(n,function(){let a=this.x-3*this.dx,h=this.y-3*this.dy;this.x+=this.dx,this.y+=this.dy,n.line(this.x,this.y,a,h),(this.x>=t-1||this.y>=e-1||this.x<0||this.y<0)&&(this.active=!1);let g=Math.hypot(this.dx,this.dy),v=Math.min(M.distance(this.x,this.y,i,r),i);this.a=128*Math.max(1-v/s,0)+64*(g/10)+64*Math.max(1-this.t++,0)});n.frame=function(){n.background(0);for(let a=0;a<20;++a){let h=(M.roll(t)+M.roll(t))/2,g=M.roll(e)+M.roll(e)/2,v=Math.min(M.distance(h,g,i,r),i),f=-Math.atan2(r-g,h-i),o=10*(v/i)+1;c.createParticle(0,h,g,Math.cos(f)*o,Math.sin(f)*o,255,255,255,0)}c.render()},n.loop()},wormhole:function(){n.init({});let t=n.width,e=n.height,i=t/2,r=e/2,s=1,c=30,a=new $(n,function(){this.dx*=1.01,this.dy*=1.01,this.x+=this.dx,this.y+=this.dy,(this.x<0||this.x>=t||this.y<0||this.y>=e)&&(this.active=!1)},function(f){f.stroke(this.r,this.g,this.b,this.a),f.point(this.x,this.y,2,2)});function h(f,o,l,d,u,p,w,y,x){let m=2*Math.PI/d;for(let b=0;b<d;++b){let E=m*b,L=f+Math.cos(E)*l,A=o+Math.sin(E)*l,C=Math.cos(E)*u,R=Math.sin(E)*u;a.createParticle(0,L,A,C,R,p,w,y,x)}}let g=i,v=r;n.frame=function(){n.background(0),n.frameCount%s===0&&(g=i+Math.cos(n.frameCount/100)*100,v=r+Math.sin(n.frameCount/100)*100,h(g,v,1,c,1,255,255,255,255)),a.render()},n.loop()}};ne.exports=Oe});var oe=j((Ue,re)=>{var mt=se(),vt=xt().Renderer(),Rt=Object.freeze({cat:{func:function(t){this.echo(mt[t].toString())},man:"Print code listing for [demo]"},clear:{func:function(){this.clear()}},help:{func:function(t){t===void 0?(this.echo("Available commands:"),Object.keys(Rt).forEach(e=>this.echo(e))):this.echo(Rt[t].man)},man:"Print help text for [command].  If no command is passed, list available commands.",usage:"help [command]"},init:{func:function(){vt.init()}},load:{func:function(t,...e){t in mt&&(this.echo(`Loading ${t}\u2026`),vt.init(),mt[t].apply(this,e))},man:"Load a demo.  Some demos accept additional arguments.\n<b>Example:</b>\n`load chaos 6`.",usage:"load [demo] [args]"},ls:{func:function(){this.echo("Available demos:"),Object.keys(mt).filter(t=>t!=="rod").forEach(t=>this.echo(t))},man:"List available demos"},properties:{func:function(t){t===void 0&&this.echo(JSON.stringify(vt,null,2)),this.echo(vt[t])}}});re.exports=Rt});var Tt=(it(),ht(et)).default,{Executor:Te}=Et();Yt();var{Renderer:Ie}=xt();Tt.setLogLevel("debug");var Ot=new Tt("index.js");window.addEventListener("load",()=>{Ot.info("Creating renderer");let t=document.querySelector("canvas"),e=t.getBoundingClientRect();t.width=e.width,t.height=e.height,Ot.debug(`initial canvas width (${t.width}) height (${t.height})`),Ie(t),Ot.info("Creating executor");let i=document.querySelector("ng-terminal"),r=new Tt("Executor.js");i.executor=Te.bind(i)(r,oe())});})();
